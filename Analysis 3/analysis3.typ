// ! external
#import "../typst/notes.typ": *
#import "../typst/shortcuts.typ": *

#import "@preview/cetz:0.2.2"

// ! configuration
#show: doc => conf(
  course_code: "MATH454",
  course_title: "Analysis 3",
  subtitle: "Measure spaces; Integration.",
  semester: "Fall 2024",
  professor: "Prof. Linan Chen",
  cute: "../analysis 3/page.png",
  doc
)

#set align(left)

// #let calold = cal

// #let cal(it) = math.class("normal",
//   text(font: "New Computer Modern Math", stylistic-set: 1, $calold(it)$)
// )


// #show math.equation: set text(font: "New Computer Modern Math") 
// $cal(A) cal(B) cal(C) cal(D) cal(E) cal(F) cal(G) cal(H) cal(I) cal(J) cal(K) cal(L) cal(M) cal(N) cal(O) cal(P) cal(Q) cal(R) cal(S) cal(T) cal(U) cal(V) cal(W) cal(X) cal(Y) cal(Z)$

// TODO starts here

= Sigma Algebras and Measures

== A Review of Riemann Integration

Let $f : RR-> RR$ and $[a,b] subset RR$. Define a *partition* of $[a,b]$ as the set $
"part"([a,b]) := {a =: x_0 < x_1 < dots.c < x_N := b}.
$
We can then define the upper and lower Riemann integrals of $f$ over the region $[a,b]$ as $
"upper:" #h(2em) overline(integral_a^b) f(x) dif x := inf_("part"([a,b])) {sum_(i=1)^N sup_(x in [x_(i-1), x_(i)]) f(x) dot.c (x_i - x_(i-1))}\
"lower:" #h(2em) underline(integral_a^b) f(x) dif x := sup_("part"([a,b])) {sum_(i=1)^N inf_(x in [x_(i-1), x_(i)]) f(x) dot.c (x_i - x_(i-1))}.
$
We then say $f$ *Riemann integrable* if these two quantities are equal, and denote this value by $integral_a^b f(x) dif x$.

Many "nice-enough" (continuous, monotonic, etc.) functions are Riemann integrable, but many that we would like to be able to "integrate" are simply not, for instance Dirichlet's function $x |-> cases(
  1  x in QQ \\ [a, b]\
0  x in QQ^c \\ [a,b]).$ Hence, we need a more general notion of integration.
// TODO

// TODO pictures

== Sigma Algebras

#definition("Sigma algebra")[
Let $X$ be a _space_ (a nonempty set) and $cal(F)$ a collection of subsets of $X$. $cal(F)$ a _sigma algebra_ or simply $sigma$-algebra of $X$ if the following hold:
+ $X in cal(F)$
+ $A in cal(F) => A^c in cal(F)$ (closed under complement)
+ ${A_n}_(n in NN) subset.eq cal(F) => union.big_(n=1)^infinity A_n in cal(F)$ (closed under countable unions)
]

#proposition[
4. $nothing in cal(F)$
5. ${A_n}_(n in NN) subset.eq cal(F) => sect.big_(n=1)^infinity A_n in cal(F)$
6. $A_1, dots, A_n in cal(F) => union.big_(n=1)^infinity A_n, sect.big_(n=1)^infinity A_n in cal(F)$
7. $A, B in cal(F) => A \\ B, B \\ A in cal(F)$
]

#example[
  The "largest" sigma algebra of a set $X$ is the power set $2^X$, the smallest the trivial ${nothing, X}$. 

  Given a set $A subset X$, the set $cal(F)_A := {nothing, X, A, A^c}$ is a sigma algebra; given two disjoint sets $A, B subset X$, then $cal(F)_(A, B) := {nothing, X, A, A^c, B, B^c, A union B, A^c sect B^c}$ a sigma algebra.
]

#definition("Generating a sigma algebra")[
  Let $X$ be a nonempty set, and $cal(C)$ a collection of subsets of $X$. Then, the $sigma$-algebra _generated_ by $cal(C)$, denoted $sigma(cal(C))$, is such that
  + $sigma(cal(C))$ a sigma algebra with $cal(C) subset.eq sigma(cal(C))$
  + if $cal(F)'$ a sigma algebra with $cal(C) subset.eq cal(F)'$, then $cal(F)' supset.eq sigma(cal(C))$

  Namely, $sigma(cal(C))$ is the smallest sigma algebra "containing" (as a subset) $cal(C)$.
]

#proposition[
  + $sigma(cal(C)) = sect.big {cal(F) : cal(F) " a sigma algebra containing " cal(C)}$
  + if $cal(C)$ itself a sigma algebra, then $sigma(cal(C)) = cal(C)$
  + if $cal(C)_1, cal(C)_2$ are two collections of subsets of $X$ such that $cal(C)_1 subset.eq cal(C)_2$, then $sigma(cal(C)_1) subset.eq sigma(cal(C)_2)$
]

#definition("The Borel sigma-algebra")[
The _Borel $sigma$-algebra_, denoted $frak(B)_RR$, on the real line is given by $
frak(B)_RR := sigma({"open subsets of " RR}).
$
We call sets in $frak(B)_RR$ _Borel sets_.
]

#proposition[
  $frak(B)_RR$ is also generated by the sets 
  - ${(a, b) : a < b in RR}$
  - ${(a, b] : a < b in RR}$
  - ${[a, b] : a < b in RR}$
  - ${[a, b) : a < b in RR}$ $ast.circle$
  - ${(-infinity, c) : c in RR}$
  - ${(-infinity, c] : c in RR}$
  - etc.
]

#proof[
We prove just $ast.circle$. It suffices to show that the generating sets of each $sigma$-algebra is contained in the other $sigma$-algebra. Let $a < b in RR$. Then, $
(a, b) = union.big_(n=1)^infinity underbrace([a + 1/n, b), in ast.circle) in sigma({[a, b)})  => frak(B)_RR subset.eq sigma({[a, b)}).
$
Conversely, $
[a, b) = sect.big_(n=1)^infinity (a - 1/n, b) in frak(B)_RR.
$
]

#proposition[
  All intervals (open, closed, half open, half closed, finite, etc) are Borel sets; any set obtained from countable set operations of intervals are Borel; all singletons are Borel; any finite and countable sets are Borel.
]

== Measures

#definition("Measurable Space")[
Let $X$ be a space and $cal(F)$ a $sigma$-algebra. We call the tuple $(X, cal(F))$ a _measurable space_.
]

#definition("Measure")[
Let $(X, cal(F))$ be a measurable space. A _measure_ is a function $mu : cal(F) -> [0, infinity]$ satisfying

(i) $mu(nothing) = 0$;

(ii) if ${A_n} subset.eq cal(F)$ a sequence of (pairwise) disjoint sets, then $
mu(union.big_(n=1)^infinity A_n) = sum_(n=1)^infinity mu(A_n),
$
i.e. $mu$ is _countably additive_. We further call $mu$
- _finite_ if $mu(X) < infinity$,
- a _probability measure_ if $mu(X) = 1$,
- $sigma$-finite if $exists {A_n} subset.eq cal(F)$ such that $X = union.big_(n=1)^infinity A_n$ with $mu(A_n) < infinity forall n >= 1$,
and call the triple $(X, cal(F), mu)$ a _measure space_.
]

#example[
  The measure on $frak(B)_RR$ given by $
  A |-> cases(|A| "if" A "finite"\ infinity " else")
  $ is called the _counting measure_. 

  Fix $x_0 in RR$, then the measure on $frak(B)_RR$ given by $
  A |-> cases(1 "if" x_0 in A\ 0 "else")
  $ is called the _point mass at $x_0$_.
]

#theorem("Properties of Measures")[
  Fix a measure space $(X, cal(F), mu)$. The following properties hold:
  + (finite additivity) For any sequence ${A_n}_(n=1)^N subset.eq cal(F)$ of disjoint sets, $
  mu(union.big_(n=1)^N A_n) = sum_(n=1)^N mu(A_n).
  $
  + (monotonicity) For any $A subset.eq B in cal(F)$, then $mu(A) <= mu(B)$.
  + (countable/finite subadditivity) For any sequence ${A_n} subset.eq cal(F)$ (*not* necessarily disjoint), $
  mu(union.big_(n=1)^infinity A_n) <= sum_(n=1)^infinity mu(A_n),
  $ an analogous statement holding for a finite collection of sets $A_1, dots, A_N$.
  + (continuity from below) For ${A_n} subset.eq cal(F)$ such that $A_n subset.eq A_(n+1) forall n >= 1$ (in which case we say ${A_n}$ "increasing" and write $A_n arrow.t$) we have $
  mu(union.big_(n=1)^infinity A_n) = lim_(n-> infinity) mu(A_n).
  $
  + (continuity from above) For ${A_n} subset.eq cal(F), A_n supset.eq A_(n+1) forall n >= 1$ (we write $A_n arrow.b$) we have that *if* $mu(A_1) < infinity$ ,
  $
  mu(sect.big_(n=1)^infinity A_n) = lim_(n-> infinity) mu(A_n).
  $
]

#remark[
In 4., note that since $A_n$ increasing, that the union $union.big_(n=1)^infinity A_n supset.eq A_m$ for any arbitrarily large $m$; indeed, one could logically right $lim_(n-> infinity) A_n = union.big_(n=1)^infinity A_n$. In this notation, then, 4. simply states that we may interchange limit and measure. A similar argument can be viewed for 5. (how?).
]

#remark[
  The finiteness condition in 5. may be slightly modified such as to state that $mu(A_n) < infinity$ for some $n$; remark why this would suffice to ensure the entire rest of the sequence has finite measure.
]

#proof[
1. Extend $A_1, dots, A_N$ to an infinite sequence by $A_n := nothing$ for $n > N$. Then this simply follows from countable additivity and $mu(nothing) = 0$.
2. We may write $B = A union (B \\ A)$; this is a disjoint union of sets. By finite additivity, then, $
mu(B) = mu(A) + mu(B \\ A) >= mu(A),
$ since the measure is positive.
3. We prove only for a countable union; use the technique from 1. to extend to finite. We first "disjointify" the sequence such that we can use the countable additivity axiom. Let $B_1 = A_1, B_n = A_n \\ (union.big_(i=1)^(n-1) A_i)$ for $n >= 2$. Remark then that ${B_n} subset.eq cal(F)$ is a disjoint sequence of sets, and that $union.big_(n=1)^infinity B_n = union.big_(n=1)^infinity A_n$. By countable additivity and subadditivity, $
mu(union.big_(n=1)^infinity A_n) = mu(union.big_(n=1)^infinity B_n) = sum_(n=1)^infinity mu(B_n) <= sum_(n=1)^infinity mu(A_n).
$
4. We again "disjointify" the sequence ${A_n}$. Put $B_1 = A_1$, $B_n = A_n \\ A_(n-1)$ for all $n >= 2$ (remark that this is equivalent to the construction from the previous proof because the sets are increasing). Then, again, $union.big_(n=1)^infinity B_n = union.big_(n=1)^infinity A_n$, and in particular, for all $N >= 1$, $union.big_(n=1)^N B_n = A_N$. Then $
mu(union.big_(n=1)^infinity A_n) = mu(union.big_(n=1)^infinity A_n) &= sum_(n=1)^infinity mu(B_n)\
&= lim_(N-> infinity) sum_(n=1)^N mu(B_n)\
&= lim_(N-> infinity) mu(union.big_(n=1)^N B_n) = lim_(N->infinity) mu(A_N).
$
5. We yet again disjointify, backwards (in a way) from the previous case. Put $B_n = A_1 \\ A_n$ for all $n  >= 1$. Then, ${B_n} subset.eq cal(F)$, $B_n$ increasing, and $union.big_(n=1)^infinity B_n = A_1 \\ sect.big_(n=1)^infinity A_n$. Then, by continuity from below, $
mu(A_1 \\ sect.big_(n=1)^infinity A_n) = mu(union.big_(n=1)^infinity B_n) = lim_(n-> infinity) mu(B_n) = lim_(n-> infinity) mu(A_1 \\ A_n)
$ and also $
mu(A_1) &= mu(A_1 \\ sect.big_(n=1)^infinity A_n) + mu(sect.big_(n=1)^infinity A_n)\
&= mu(A_1 \\ A_n) + mu(A_n),
$ and combining these two equalities yields the desired result.
]

== Constructing the Lebesgue Measure on $RR$

#definition("Lebesgue outer measure")[
For all $A subset.eq RR$, define $
m^ast (A) := inf { sum_(n=1)^infinity ell(I_n) : A subset.eq union.big_(n=1)^infinity I_n, I_n "open intervals"},
$ called the _Lebesgue outer measure_ of $A$ (where $ell(I)$ is the length of interval $I$, i.e. the absolute value of the difference of its endpoints, if finite, or $infinity$ if not).
]

#proposition[
  The following properties of $m^ast$ hold:
  + $m^ast (A) >= 0$ for all $A subset.eq RR$, and $m^ast (nothing) = 0$.
  + (monotonicity) For $A subset.eq B$, $m^ast (A) lt.eq m^ast (B)$.
  + (countable subadditivity) For ${A_n}, A_n subset.eq RR$, $m^ast (union.big_(n=1)^infinity A_n) lt.eq sum_(n=1)^infinity m^ast (A_n)$.#footnote([More generally, any set function on $2^RR$ that satisfies 1., 2., and 3. is called an _outer measure_.])
  + If $I subset.eq RR$ an interval, then $m^ast (I) = ell(I)$.
  + $m^ast$ is translation invariant; for any $A subset.eq R, x in RR$, $m^ast (A) = m^ast (A + x)$ where $A + x := {a + x : a in A}$.
  + For all $A subset.eq RR$, $m^ast (A) = inf {m^ast (B) : A subset.eq B subset.eq R, B - "open"}$.
  + If $A = A_1 union A_2 subset.eq RR$ with $d(A_1, A_2) > 0,$#footnote("Remark: this is a stronger requirement than disjointness!") then $m^ast (A_1) + m^ast (A_2) = m^ast (A)$.
  + If $A = union.big_(k=1)^infinity J_k$ where $J_k$'s are "almost disjoint intervals" (i.e. share at most endpoints), then $m^ast (A) = sum_(k=1)^infinity m^ast (J_k) = sum_(k=1)^infinity ell(J_k).$
]

#proof[
3. If $m^ast (A_n) = infinity$, for any $n$, we are done, so assume wlog $m^ast (A_n) < infinity$ for all $n$. Then, for each $n$ and $epsilon > 0$, one can choose open intervals ${I_(n,i)}_(i >= 1)$ such that $A_n subset.eq union.big_(i=1)^infinity I_(n, i)$ and $sum_(i=1)^infinity ell(I_(n,i)) lt.eq m^ast (A_n) + epsilon/(2^n)$. Hence $
union.big_(n=1)^infinity A_n subset.eq union.big_(n=1, i = 1)^infinity I_(n, i)\
=> m^(ast) (union.big_(n=1)^infinity A_n) lt.eq sum_(n, i = 1)^infinity ell(I_(n, i)) = sum_(n=1)^infinity sum_(i=1)^infinity ell(I_(n, i)) lt.eq sum_(n=1)^infinity (m^ast (A_n) + epsilon/(2^n)) = sum_(n=1)^infinity m^(ast) (A_n) + epsilon,
$
and as $epsilon$ arbitrary, the statement follows.

4. We prove first for $I = [a, b]$. For any $epsilon > 0$, set $I_1 = (a - epsilon, b + epsilon)$; then $I subset.eq I_1$ so $m^ast (I) lt.eq ell(I_1) = (b - 1) + 2 epsilon$ hence $m^ast (I) lt.eq b - a = ell(I)$. Conversely, let ${I_n}$ be any open-interval convering of $I$ (wlog, each of finite length; else the statement holds trivially). Since $I$ compact, it can be covered by finitely many of the $I_n$'s, say ${I_n}_(n=1)^N$, denoting $I_n = (a_n, b_n)$ (with relabelling, etc). Moreover, we can pick the $a_n, b_n$'s such that $a_1 < a, b_N > b$, and generally $a_n < b_(n-1) forall 2 <= n <= N$. Then, $
sum_(n=1)^infinity ell(I_n) gt.eq sum_(n=1)^N ell(I_n) &= b_1 - a_1 + sum_(n=2)^N (b_n - a_n)\
& >= b_1 - a_1 + sum_(n=2)^N (b_n - b_(n-1)) \
&= b_N - a_1 >= b- 1 = ell(I),
$ hence since the cover was arbitrary, $m^(ast) (A) >= ell(I)$, and equality holds.

Now, suppose $I$ finite, with endpoints $a < b$. Then for any $(b-a)/2 > epsilon > 0$, then $
[a + epsilon, b - epsilon] subset.eq I subset.eq [a - epsilon, b + epsilon],
$ hence by monotonicity and the previous part of this proof $
m^ast ([a + epsilon, b - epsilon]) = b - a -2epsilon <= m^ast (I) <= b - a + 2 epsilon = m^ast ([a - epsilon, b + epsilon]),
$ from which it follows that $m^ast (I) = b - a = ell(I)$.

Finally, suppose $I$ infinite. Then, $forall M >= 0, exists$ closed, finite interval $I_M$ with $I_M subset.eq I$ and $ell(I_M) >= M$. Hence, $m^ast (I) >= m^ast (I_M) >= M$ and thus as $M$ arbitrary it must be that $m^ast (I) = infinity = ell(I)$.

6. Denote $tilde(m) (A) := inf {m^ast (B) : A subset.eq B subset.eq RR, B - "open"}$. For any $A subset.eq B subset.eq RR$ with $B$ open, monotonicity gives that $m^ast (A) <= m^ast (B)$, hence $m^ast (A) <= tilde(m) (A)$. Conversely, assuming wlog $m^ast (A) < infinity$ (else holds trivially), then for all $epsilon > 0$, there exists ${I_n}$ such that $A subset.eq union.big_(n=1)^infinity I_n$ with $sum_(n=1)^infinity ell(I_n) <= m^ast (A) + epsilon$. Setting $B := union.big_(n=1)^infinity I_n$, we have that $A subset.eq B$ and $m^ast (B) = m^ast (union.big I_n) <=$ (by finite subadditivity) $sum_(n=1)^infinity m^ast (I_n) = sum_(n=1)^infinity ell(I_n) <= m^ast (A) + epsilon$  hence $m^ast (B) <= m^ast (A)$ for all $B$. Thus $m^ast (A) >= tilde(m)(A)$ and equality holds.

7. Put $delta := d(A_1, A_2) > 0$. Clearly $m^ast (A) <= m^ast (A_1) + m^ast (A_2)$ by finite subadditivity. wlog, $m^ast (A) < infinity$ (and hence $m^ast (A_i) < infinity, i = 1, 2$) (else holds trivially). Then $forall epsilon > 0, exists {I_n} : A subset.eq union.big I_n$ and $sum ell(I_n) <= m^ast (A) + epsilon$. Then, for all $n$, we consider a "refinement" of $I_n$; namely, let ${I_(n, i)}_(i >= 1)$ such that $I_n subset.eq union.big_(i) I_(n, i)$ and $ell(I_(n, i)) < delta$ and $sum_(i) ell(I_(n, i)) <= ell(I_n) + epsilon/(2^n)$. Relabel ${I_(n, i) : n, i >= 1} arrow.squiggly {J_m : m >= 1}$ (both are countable). Then, ${J_m}$ defines an open-interval cover of $A$, and since $ell(J_m) < delta$ for each $m$, $J_m$ intersects at most one $A_i$. For each $m$ and $p = 1, 2$, put $
M_p := {m : J_m sect A_p eq.not nothing},
$ noting that $M_1 sect M_2 = nothing$. Then ${J_m : m in M_p}$ is an open covereing of $A_p$, and so $
m^ast (A_1) + m^ast (A_2) &<= sum_(m in M_1) ell(J_m) + sum_(m in M_2) ell(J_m) \
& <= sum_(m=1)^infinity ell(J_m) = sum_(n, i = 1)^infinity ell(I_n, i)\
& <= sum_(n) (ell(I_n) + epsilon/(2^n))\
& = sum_(n) ell(I_n) + epsilon \
& <= m^ast (A) + 2 epsilon,
$ and hence equality follows.
8. If $ell(J_k) = infinity$ for some $k$, then since $J_k subset.eq A$, subadditivity gives us that $m^ast (J_k) <= m^ast (A)$ and so $m^ast (A) = infinity = sum_(k=1)^infinity ell(J_k)$ (since if any $J_k$ infinite, the sum of the lengths of all of them will also be infinite).

Suppose then $ell(J_k) < infinity$ for all $k$. Fix $epsilon > 0$. Then for all $k >= 1$, choose $I_k subset.eq J_k$ such that $ell(J_k) <= ell(I_k) + epsilon/(2^k)$. For any $N >= 1$, we can choose a subset ${I_1, dots, I_N}$ of intervals such that all are disjoint, with strictly positive distance between them, and so $
union.big_(k=1)^N I_k subset.eq union.big_(k=1)^N I_k subset.eq A\
=> m^ast (A) >= m^ast (union.big_(k=1)^N I_k ) &>= sum_(k=1)^N ell(I_k) \
&>= sum_(k=1)^N (ell (J_k) - epsilon/(2^k))\
& >= sum_(k=1)^N ell(J_k) - epsilon\
implies m^ast (A) >= sum_(k=1)^infinity ell(J_k),
$ the second inequality following from finite subadditivity. The converse of the final inequality holds trivially.
]

== Lebesgue-Measurable Sets

#definition[$A subset.eq RR$ is _$m^ast$-measurable_ if $forall B subset.eq RR$, $
m^ast (B) = m^ast (B sect A) + m^ast (B sect A^c).
$]

#remark[
By subadditivity, $<=$ always holds in the definition above.
]

#theorem("Carathéodary's Theorem")[
  Let $
  cal(M) := {A subset.eq RR : A #h(0.5em) m^ast-"measurable"}.
  $ Then, $cal(M)$ is a $sigma$-algebra of subsets of $RR$.

  Define $m : cal(M) -> [0, infinity]$, $m(A) = m^ast (A)$. Then, $m$ is a measure on $cal(M)$, called the _Lebesgue measure_ on $RR$. We call sets in $cal(M)$ _Lebesgue-measurable_ or simply _measurable_ (if clear from context) accordingly. We call $(RR, cal(M), m)$ the _Lebesgue measure space_.
]

#proof[
The first two $sigma$-algebra axioms are easy. We have for any $B subset.eq RR$ that $
m^ast (B sect RR) + m^ast (B sect RR^c) = m^ast (B) + m^ast (B sect nothing) = m^ast (B)
$ so $RR in cal(M)$. Further, $A in cal(M) => A^c in cal(M)$ by the symmetry of the requirement for sets to be in $cal(M)$.

The final axiom takes more work. We show first $cal(M)$ closed under finite unions; by induction it suffices to show for $2$ sets. Let $A_1, A_2 in cal(M)$. Then, for all $B subset.eq RR$, $
m^ast (B) &= m^ast (B sect A_1) + m^ast (B sect A_1^c) \
&=  m^ast (B sect A_1) + m^ast (B sect A_1^c sect A_2) + m^ast (B sect A_1^c sect A_2^c)\
&=  m^ast (B sect A_1) + m^ast (B sect A_1^c sect A_2) + m^ast (B sect (A_1 union A_2)^c)
$ Note that $(B sect A_1) union (B sect A_1^c sect A_2^c) = B sect (A_1 union A_2)$, hence by subadditivity, $
m^ast (B) >= m^ast (B sect (A_1 union A_2)) + m^ast (B sect (A_1 union A_2)^c),
$ and since the other direction of the inequality comes for free, we conclude $A_1 union A_2 in cal(M)$.

Let now ${A_n} subset.eq cal(M)$. We "disjointify" ${A_n}$; put $B_1 := A_1$, $B_n := A_n \\ union.big_(i=1)^(n-1) A_i, n >= 2$, noting $union.big_n A_n = union.big_n B_n$, and each $B_n in cal(M)$, as each is but a finite number of set operations applied to the $A_n$'s, and thus in $cal(M)$ as demonstrated above. Put $E_n := union.big_(i=1)^n B_i$, noting again $E_n in cal(M)$. Then, for all $B subset.eq RR$, $
m^ast (B) &= m^ast (underbrace(B sect E_n, "chop up" B_n)) +m^ast ( underbrace(B sect E_n^c, E_n subset.eq union B_n => E_n^c supset.eq (union B_n)^c))\
&>= m^ast (B sect underbrace(E_n sect B_n, = B_n)) + m^ast (B sect underbrace(E_n sect B_n^c, = E_(n-1))) + m^ast (B sect (union.big_(n=1)^infinity B_n)^c)\
& >= m^ast (B sect B_n) + m^ast (underbrace(B sect E_(n-1), "chop up" B_(n-1))) + m^ast (B sect (union.big_(n=1)^infinity B_n)^c)\
& >= m^ast (B sect B_n) + m^ast (B sect E_(n-1) sect B_(n-1)) \
& #h(2em)+ m^ast (B sect E_(n-1) sect B_(n-1)^c) + m^ast (B sect (union.big_(n=1)^infinity B_n)^c).
$ Notice that the last line is essentially the second applied to $B_(n-1)$; hence, we have a repeating (essentially, "descending") pattern in this manner, which we repeat until $n -> 1$. We have, thus, that $
m^ast (B) >= sum_(i=1)^n [ m^ast (B sect B_i)] + m^ast (B sect (union.big_(n=1)^infinity B_n)^c),
$ so taking $n -> infinity$, $
m^ast (B) &>=  sum_(i=1)^infinity [ m^ast (B sect B_i)] + m^ast (B sect (union.big_(n=1)^infinity B_n)^c)\
& >= m^ast (B sect (union.big_(n=1)^infinity B_n)) + m^ast (B sect (union.big_(n=1)^infinity B_n)^c).
$ As usual, the inverse inequality comes for free, and thus we can conclude $union.big_(n=1)^infinity B_n$ also $m^ast$-measurable, and thus so is $union.big_(n=1)^infinity A_n$. This proves $cal(M)$ a $sigma$-algebra.

We show now $m$ a measure. By previous propositions, we have that $m >= 0$ and $m(nothing) = 0$ (since $m = m^ast |_cal(M)$), so it remains to prove countable subadditivity.

Let ${A_n} subset.eq cal(M)$-disjoint. Following precisely the same argument as above, used to prove that $cal(M)$ closed under countable unions, shows that for any $n >= 1$ $
m (union.big_(i=1)^n A_i) = sum_(i=1)^n m(A_i),
$ that is, finite additivity holds, and thus by subadditivity $
m (union.big_(i=1)^infinity A_i) >= m (union.big_(i=1)^n A_i)  =sum_(i=1)^n m(A_i),
$ and so taking the limit of $n -> infinity$, we have 
$
m (union.big_(i=1)^infinity A_i) >= sum_(i=1)^infinity m(A_i),
$ with the converse inequality coming for free. Thus, $m$ indeed a measure on $cal(M)$.
]

#proposition[
$cal(M), m$ translation invariant; for all $A in cal(M)$, $x in RR$, $x + A = {x  + a : a in A} in cal(M)$ and $m (A) = m(A + x)$.
]
#remark[
  We would like this to hold, heuristically, since if we shift sets on the real line, we should expect their length to remain constant.
]

#proof[
For all $B subset.eq RR$, we have (since $m^ast$ translation invariant) $
m^ast (B) = m^ast (B - x) &= m^ast (underbrace((B - x) sect A, = B sect (A + x))) +m^ast (underbrace((B - x) sect A^c, = B sect (A^c + x) = B sect (A + x)^c))\
&= m^ast (B sect (A + x)) + m^ast (B sect (A + x)^c),
$ thus $A + x in cal(M)$, and since $m^ast$ translation invariant, it follows that $m$ is.
]

#theorem[
$forall a, b in RR$ with $a< b$, $(a, b) in cal(M)$, and $m((a, b)) = b - a$.
]
#remark[
  Again, we'd like this to hold, heuristically, since we would like the measure of an interval to simply be its length; we'd moreover like to be able to measure intervals, i.e. have intervals be contained in $cal(M)$.
]
#corollary[$frak(B)_RR subset.eq cal(M)$]

#proof[
  $frak(B)_RR$ is generated by open intervals of the form $(a, b)$. All such intervals are in $cal(M)$ by the previous theorem, and hence the proof.
]

== Properties of the Lebesgue Measure

#proposition([Regularity Properties of $m$])[For all $A in cal(M)$, the following hold.
- For all $epsilon >0, exists G$ open such that $A subset.eq G$ and $m(G\\A) < epsilon$.
- For all $epsilon > 0$, $exists F$-closed such that $F subset.eq A$ and $m(A\\F) <= epsilon$.
- $m(A) = inf {m(G) : G "open", G supset.eq A}$.
- $m(A) = sup {m(K) : K "compact", K subset.eq A}$.
- If $m (A) < infinity$, then for all $epsilon > 0$, $exists K subset.eq A$ compact, such that $m (A \\ K) < epsilon$.
- If $m(A) < infinity$, then for all $epsilon >= 0$, $exists$ finite collection of open intervals $I_1, dots, I_N$ such that $m(A triangle.t.small (union.big_(n=1)^N I_n)) <= epsilon$.
]

#proposition([Completeness of $m$])[$(RR, cal(M), m)$ is _complete_, in the sense that for all $A subset.eq RR$, if $exists B in cal(M)$ such that $A subset.eq B$ and $m(B) = 0$, then $A in cal(M)$ and $m(A) = 0$. 

Equivalently, any subset of a null set is again a null set.
]

// TODO proof
#remark[In general, $A in cal(F), B subset.eq A cancel(=>) B in cal(F)$.]

#proposition[Up to rescaling, $m$ is the unique, nontrivial measure on $(RR, frak(B)_RR)$ that is finite on compact sets and is translation invariant, i.e. if $mu$ another such measure on $(RR, frak(B)_RR)$ with $mu = c dot.c m$ for $c > 0$, then $mu = m$.]

#remark[Such a $c$ is simply $c = mu((0,1))$.]

To prove this proposition, we first introduce some helpful tooling:
#theorem([Dynkin's $pi$-d])[Given a space $X$, let $cal(C)$ be a collection of subsets of $X$. $cal(C)$ is called a _$pi$-system_ if $A, B in cal(C) => A sect B in cal(C)$ (that is, it is closed under finite intersections).

Let $cal(F) = sigma (cal(C))$, and suppose $mu_1, mu_2$ are two finite measures on $(X, cal(F))$ such that $mu_1 (X) = mu_2 (X)$ and $mu_1 = mu_2$ when restricted to $cal(C)$. Then, $mu_1 = mu_2$ on all of $cal(F)$.
]

#proposition[${nothing} union {(a, b) : a < b  in RR}$ a $pi$-system.]

#proposition[If $mu$ a measure on $(RR, frak(B)_RR)$ such that for all intervals $I$, $mu (I) = ell (I)$, then $mu = m$.]

#proof[Consider for all $n >= 1$ $mu|_(frak(B)_([-n,n]))$. Clearly, $mu ([-n, n]) = m([-n, n]) = 2n$, and for all $a, b in RR$, $mu((a, b) sect [-n,n]) = ell ((a, b) sect [-n, n]) = m((a, b) sect [-n, n])$. Thus, by the previous theorem, $mu$ must match $m$ on all of $frak(B)_([-n,n])$.

Let now $A in frak(B)_RR$. Let $A_n := A sect [-n, n] in frak(B)_([-n,n])$. By continuity of $m$ from below, $
mu(A) &= lim_(n-> infinity) mu(A_n)\
&= lim_(n -> infinity) m(A_n)\
&= m(A),
$ hence $mu = m$.
]

#proposition[If $mu$ a measure on $(RR, borel)$ assigning finite values to compact sets and is translation invariant, then $mu = c m$ for some $c > 0$.]

#remark[
  This proposition is also tacitly stating that $borel$ translation invariant; this needs to be shown.
]
#lemma[$borel$ translation invariant; for any $A in borel, x in RR, A + x in borel$.]

#proof[
  We employ the "good set strategy"; fix some $x in RR$ and let $
  Sigma := {B in borel : B + x in borel}.
  $
  We have by construction $Sigma subset.eq borel$. One can check too that $Sigma$ a $sigma$-algebra. But in addition, its easy to see that ${(a, b) : a <b in RR} subset.eq Sigma$, since a translated interval is just another interval, and since these sets generate $borel$, it must be further that $borel subset.eq Sigma$, completing the proof.
]

#proof[(of the proposition) Let $c = mu((0, 1])$, noting that $c > 0$ (why? Consider what would happen if $c = 0$).

This implies that $forall n >= 1$, $mu ((0, 1/n]) = c/n$ (obtained by "chopping up" $(0, 1]$ into $n$ disjoint intervals); from here we can draw many further conclusions: $
&forall m = 1, dots, n - 1, mu((0, m/n]) = m/n c\
&=> forall q in QQ sect (0, 1], mu((0, q]) = q c\
&=> forall q in QQ^+, mu ((0, q]) = q dot c "(translate)"\
&=> forall a in RR, mu((a, a + q]) = q dot c\
&=> forall "intervals" I, mu(I) = c dot ell (I) "(continuity)"\
&=> forall n >= 1, a, b in RR, mu((a, b) sect [-n, n]) = c dot ell ((a, b) sect [-n, n]) = c dot m ((a, b) sect [-n, n]),
$
but then, $mu = c dot m$ on $borel_[-n,n]$, and by appealing again the Dynkin's, $mu = c dot m$ on all of $borel$.
]

#proposition("Scaling")[$m$ has the _scaling property_ that $forall A in cal(M)$, $c in RR$, $c dot A = {c x : x in A} in cal(M)$, and $m (c dot A) = |c| m(A)$.]

#proof[Assume $c eq.not 0$. Given $A subset.eq RR$, remark that ${I_n}$ an open interval cover of $A$ iff ${c I_n}$ and open interval cover of $c A$, and $ell (c I_n) = |c| ell(I_n)$, and thus $m^ast (c A) = |c| m^ast (A)$.

Now, suppose $A in cal(M)$. Then, we have for any $B subset.eq RR$, $
m^ast (B) = |c| m^ast (1/c B) &= |c| m^ast (1/c B sect A) + |c| m^ast (1/c B sect A^c)\
&= m^ast (B sect c A) + m^ast (B sect  (c A)^c),
$ so $c A in cal(M)$.
]

== Relationship between $borel$ and $cal(M)$

#definition[Given $(X, cal(F), mu)$, consider the following collection of subsets of $X$, $
cal(N) := {B subset.eq X : exists A in cal(F) "s.t." mu(A) =0, B subset.eq A}.
$ Put $overline(cal(F)) := sigma (cal(F) union cal(N))$; this is called the _completion_ of $cal(F)$ with respect to $mu$.
]

#proposition[$overline(cal(F)) = {F subset.eq X : exists E, G in cal(F) "s.t." exists E subset.eq F subset.eq G "and" m(G \\ E) = 0}$.]

#proof[
Put $cal(G)$ the set on the right; one can check $cal(G)$ a $sigma$-algebra. Since $cal(F) subset.eq cal(G)$  and $cal(N) subset.eq cal(G)$, we have $overline(cal(F)) subset.eq cal(G)$.

Conversely, for any $F in cal(G)$, we have $E, G in cal(F)$ such that $E subset.eq F subset.eq G$ with $m(G \\ E) = 0$. We can rewrite $
F = underbrace(E, in cal(F)) union underbrace((F \\ E), subset.eq G \\ E \ => mu (F \\ E )= 0 \ => G\\E in cal(N)),
$ hence $F in cal(F) union cal(N)$ and thus in $cal(F)$, and equality holds.
]

#definition[Given $(X, cal(F), mu)$, $mu$ can be _extended_ to $overline(cal(F))$ by, for each $F in overline(cal(F))$ with $E subset.eq F subset.eq G$ s.t. $mu(G\\E) = 0$, put $
mu(F) = mu(E) = mu(G).
$ We call then $(X, cal(F), mu)$ a _complete measure space_.]

#remark[It isn't obvious that this is well defined a priori; in particular, the $E, G$ sets are certainly not guaranteed to be unique in general, so one must check that this definition is valid regardless of choice of "sandwich sets".]

#theorem[$(RR, cal(M), m)$ is the completion of $(RR, borel, m)$.]

#proof[
  Given $A in cal(M)$, then $forall n >= 1, exists G_n$-open with $A subset.eq G_n$ s.t. $m^ast (G_n \\ A) <= 1/n$ and $exists F_n$-closed with $F_n subset.eq A$ s.t. $m^ast (A \\ F_n) <= 1/n$.

  Put $C := sect.big_(n=1)^infinity G_n$, $B := sect.big_(n=1)^infinity F_n$, remarking that $C, B in borel$, $B subset.eq A subset.eq C$, and moreover $
  m(C \\ A) <= 1/n, m(A \\ B) <= 1/n\
  => m(C \\ B) = m(C\\A) + m(A \\ B) <= 2/n,
  $
  but $n$ can be arbitrarily large, hence $m (C \\ B) = 0$; in short, given a measurable set, we can "sandwich it" arbitrarily closely with Borel sets. Thus, $A in overline(borel) => cal(M) subset.eq overline(borel)$. But recall that $cal(M)$ complete, so $borel subset.eq cal(M) => overline(borel) subset.eq overline(cal(M)) = cal(M)$, and thus $overline(borel) = cal(M)$ indeed.

  Heuristically, this means that any measurable set is "different" from a Borel set by at most a null set.
]

== Some Special Sets
=== Uncountable Null Set?

Remark that for any countable set $A in cal(M)$, $m(A) = 0$; indeed, one may write $A = union.big_(n=1)^infinity {a_n}$ for singleton sets ${a_n}$, and so $
m(A) = sum_(n=1)^infinity m(a_n) = 0.
$ One naturally asks the opposite question, does there exist a measurable, _uncountable_ set with measure 0? We construct a particular one here, the Cantor set, $C$.

This requires an "inductive" construction. Define $C_0 = [0, 1]$, and define $C_k$ to be $C_(k-1)$ after removing the middle third from each of its disjoint components. For instance $C_1 = [0, 1/3] union [2/3, 1]$, then $C_2 = [0, 1/9] union [2/9, 1/3] union [2/3, 7/9] union [8/9, 1]$, and so on. This may be clearest graphically:

#align(center,
  cetz.canvas({
    import cetz.draw: *
    line((0, 5), (5, 5))

    line((0, 4), (5/3, 4))
    line((2*5/3, 4), (2*5/3+5/3, 4))

    line((0, 3), (5/9, 3))
    line((2*5/9, 3), (2*5/9+5/9, 3))
    line((0+2*5/3, 3), (5/9+2*5/3, 3))
    line((2*5/9+2*5/3, 3), (2*5/9+5/9+2*5/3, 3))

    content((5/3/2, 2), $dots.v$)
    content((5-5/6, 2), $dots.v$)

    content((6, 5), $C_0$)
    content((6, 4), $C_1$)
    content((6, 3), $C_2$)
    content((6, 2), $dots.v$)
  })
)

 Remark that the $C_n arrow.b$. Put finally $
C := sect.big_(n=1)^infinity C_n.
$

#proposition[The following hold for the Cantor set $C$:

+ $C$ is closed (and thus $C in borel$);
+ $m(C) = 0$;
+ $C$ is uncountable.
]

#proof[
1. For each $n$, $C_n$ is the countable (indeed, finite) union of $2^n$-many disjoint, closed intervals, hence each $C_n$ closed. $C$ is thus a countable intersection of closed sets, and is thus itself closed.

2. For each $n$, each of the $2^n$ disjoint closed intervals in $C_n$ has length $1/3^n$, hence $
m(C_n) = 2^n / 3^n = (2/3)^n.
$ Since ${C_n} arrow.b$, by continuity of $m$ we have $
m(C) = lim_(n=> infinity) m(C_n) = lim_(n-> infinity) (2/3)^n = 0.
$

3. This part is a little trickier. Notice that for any $x in [0, 1]$, we can define a sequence $(a_n)$ where each $a_n in {0, 1, 2}$, and such that $
x = sum_(n=1)^infinity a_n/3^n;
$ in particular, this is just the base-3 representation of $x$, which we denote $(x)_3 = (a_1 a_2 dots.c)$.

I claim now that $
C = {x in [0, 1] : (x)_3 "has no" 1"'s"}.
$ Indeed, at each stage $n$ of the construction of the Cantor set, we get rid of the segment of the real line that would correspond to the $a_n = 1$. One should note that $(x)_3$ not necessarily unique; for instance $(1/3)_3 = (1, 0, 0, dots) = (0, 2, 2, dots)$, but if we specifically consider all $x$ such that there _exists_ a base three representation with no 1's, i.e. like $1/3$, then $C$ indeed captures all the desired numbers.

Thus, we have that $
"card"(C) = "card"({{ a_n} : a_n = 0, 2}).
$ Define now the function $
f : C -> [0, 1], #h(1em) x |-> sum_(n=1)^infinity a_n/2 dot 1/2^n, "where" (x)_3 = (a_n)
$ i.e., we "squish" the base-3 representation into a base-2 representation of a number. This is surjective; for any $y in [0, 1]$, $(b_n) := (y)_2$ contains only 0's and 1's, hence $(2 b_n)$ contains only $0$'s and $1$'s, so let $x$ be the number such that $(x)_3 = (2 b_n)$. This necessarily exists, indeed, we simply take our definitions backwards: $
x := sum_(n=1)^infinity (2 b_n)/3^n,
$ which maps to $y$ under $f$ and is contained in $C$. Hence, $"card"(C) >= "card"([0, 1])$; but $[0, 1]$ uncountable, and thus so is $C$.
]

We can naturally extend the function $f$ used here to map the entire interval $[0, 1] -> [0, 1]$ as follows $
f(x) := cases(
  sum_(n=1)^infinity a_n/2 dot.c 1/2^n "if" x in C\, (x)_3 = (a_n),
  f(a) "if" x in.not C "then" x in (a, b) "s.t." (a, b) "removed from " [0, 1]
).
$
This function is often called the _Devil's Staircase_ or _Cantor-Lebesgue function_.

#proposition[
  1. $f(0) = 0, f(1) = 1, f equiv 1/2$ on $(1/3, 2/3)$, $f equiv 1/4$ on $(1/9, 2/9)$
  2. $f : [0, 1] -> [0, 1]$ a surjection
  3. $f$ is nondecreasing
  4. $f$ is continuous
]

#proof[
  1., 2., clear from construction. 
  
  For 3., let $x_1 < x_2 in C$, and suppose $(x_1)_3 = (a_n), (x_2)_3 = (b_n)$. Then, since $x_1 < x_2$, it must be that $a_n, b_n$ can only be equal up to some finite $N$; then the next $0 = a_(N+1) < b_(N+1) = 2$. Hence, it follows that the "modified binary expansion" that arises from $f$ gives directly that $f(x_1) <= f(x_2)$.

  For 4., $f$ is clearly continuous on $[0,1] minus C$, since it is piecewise-constant here. Also, $f$ is "one-sided continuous" at each of the "boundary points" $1/3, 2/3, 1/9, 2/9, dots$. If $x in C$, for any $n >=1 $, there must be $x_n, x_n '$ such that $x_n < x < x_n '$ (if $x = 0$, only need $x_n '$, if $x = 1$, only need $x_n$) and $f(x_n ') - f(x_n) <= 1/2^n$. Then, $f$ is continuous at $x$ by monotonicity of $f$.
]

=== Non-Measurable Sets?
We've shown then that there is indeed an uncountable set of measure 0. Another question we may ask ourselves is, is there a $A subset.eq RR$ that is non-measurable? The answer to this turns out to be yes, but the construction requires invoking the axiom of choice:

#axiom("Of Choice")[If $Sigma$ a collection of nonempty sets, then $exists$ a function $
S : Sigma -> union.big_(A in Sigma) A,
$ such that $A in sigma$, $S(A) in A$. Such a function is called a _selection function_, and $S(A)$ a _representative_ of $A$.]

We construct now a non-measurable set, assuming the above. Consider $[0, 1]$, and define an equivalence relation $tilde$ on $[0, 1]$ by $
a tilde b <=> a - b in QQ.
$ Its easy to check that this is indeed an equivalence relation. Denote by $E_a$ the equivalence class containing $a$, and set $Sigma = {E_a : a in [0, 1]}$. Note that for any $E_a in Sigma, E_a eq.not nothing$. 

Invoking the axiom of choice, we can select exactly one element $S_a$ from $E_a$ for each $E_a in Sigma$. Set $
N := {S_a : S_a "is a representative of " E_a, E_a in Sigma}.
$

#proposition[
  $N$, called a _Vitali set_, is non-measurable.
]

#proof[
  Assume towards a contradiction that $N$ indeed measurable, $N in cal(M)$. Consider $[-1, 1] sect QQ$; this is countable, so we can enumerate it ${q_k}$, $k >=1$. For each $k$, put $
  N_k := N + q_k.
  $ By the assumption of measurability and translation invariance of $m$, it must be that each $N_k$ measurable and has the same measure as $N$.

  We claim each $N_k$ disjoint. Assume not, then $exists k eq.not ell$ (i.e. $q_k eq.not q_ell$) and $S_a, S_b in N$ such that $S_a + q_k = S_b + q_ell$. But then $S_a - S_b = q_ell - q_k in QQ$, hence $S_a tilde S_b$. But we constructed $N$ to have only one representative from each equivalence class, hence it must be that $S_a = S_b$, and so $S_a + q_k = S_a + q_ell => q_k = q_ell$, contradicting the assumed distinctness of the $q$'s; hence, the $N_k$'s indeed disjoint.

  We claim next that $[0, 1] subset.eq union.big_(k=1)^infinity N_k$. Let $x in [0, 1]$. Then, $x tilde S_a$ for some unique $S_a in N$ and so $x - S_a in QQ$. But also, $x, S_a in [0, 1]$, hence $x - S_a in [-1, 1]$ (moreover, $x - S_a in [-1, 1] sect QQ$) and there must exist a $k$ such that $x - S_a = q_k$, since the $q_k$'s enumerate the entire $[-1, 1] sect QQ$. Thus, $x in N_k$ by the construction of the $N_k$'s. Thus, $[0, 1] subset.eq union.big_(n=1)^infinity N_k$ indeed.

  On the other hand, $union.big_(k=1)^infinity N_k subset.eq [-1, 2]$ and so we have the "bound" $
  [0, 1] subset.eq union.big_(n=1)^infinity N_k subset.eq [-1, 2].
  $ Taking the measure of all sides then, we have the bound $
  1 <= mu (union.big_(n=1)^infinity N_k) <= 3.
  $ Invoking the disjointness of the $N_k$'s, we can also use countable additivity to write $
  mu (union.big_(n=1)^infinity N_k) = sum_(k=1)^infinity m(N_k) = sum_(k=1)^infinity m(N),
  $ but this final line is a sequence of positive, constant real numbers; hence, it is impossible for it to be within $1$ and $3$, and we have a contradiction. Hence, $N$ indeed not measurable.

  Remark that this proof also shows that $m^ast (N_k) > 0$ so $m^ast (N) > 0$ (given the interval bound on $N$ we've found).
]

#proposition[
  For every $A in cal(M)$ such that $m(A) > 0$, there exists $B subset.eq A$ such that $B$ is non-measurable.
]

#proof[
  Assume otherwise, that there is a $A in cal(M)$ with $m(A) > 0$ such that any subset $B$ of $A$ is also measurable.

  Remark that $A subset.eq union.big_(n in ZZ) A sect [n, n + 1]$. Then, there exists an $n$ such that $m ( A sect [n, n + 1]) > 0$ and thus, translating $A' := A sect [n, n + 1] - n)$, $m(A') > 0$, noting that $A' subset.eq [0, 1]$. Now, for any $B'subset.eq A'$, $B' + n subset.eq A$. By assumption, then $B' + n$ must be measurable so $B'$ measurable.

  In summary, then, we have $A' subset.eq [0, 1]$ with $m (A') > 0$ such that (by assumption) $B'$ measurable for all $B' subset.eq A'$.

  Let $N, {q_k}, N_k$ be as in the previous proof. Set $
  A_k ' := A' sect N_k, k >= 1.
  $ Then, $A_k '$ disjoint, and $
  A' = [0, 1] sect A' subset.eq union.big_(k=1)^infinity (N_k sect A') = union.big_(k=1)^infinity A_k'.
  $ Since $m(A') > 0$, there exists a $k$ such that $m(A_k ') > 0$. Set, for this $k$, $
  L := {ell >= 1 : q_ell + q_k in [-1, 1]}.
  $ This set is again countably infinite. We translate, obtaining a disjoint sequence of sets ${q_ell + A_k ' : ell in L}$; since $q_ell + q_k in [-1, 1] sect QQ$, then $q_ell + q_k = q_m$ for some unique $m$, and so $q_ell + A_k ' = q_ell + A' sect (N + q_k) subset.eq N_m$. Hence, we have on the one hand that by countable additivity $
  union.big_(ell in L) (q_ell + A_k ') subset.eq [-1, 2] => sum_(ell in L) m(q_ell + A_k ') <= 3,
  $ and so it must be that $m(q_ell + A_k ') = m(A_k ') = 0$ (else the series couldn't be finite), contradicting the finiteness assumption on $m(A_k ')$.
]

=== Non-Borel Measurable Set?
We may ask, is there $A in cal(M)$ such that $A in.not borel$?

Let $f : [0, 1] -> [0, 1]$ be the Cantor-Lebesgue function, and put $g(x) = f(x) + x$; note that $g$ is continuous and strictly increasing, and is defined $g : [0, 1] -> [0, 2]$. Remark that $g$ bijective; the strictly increasing gives injective, and moreover $g(0) = 0, g(1) = 2$ hence by intermediate value theorem it is surjective. Hence, $g^(-1) : [0, 2] -> [0, 1]$ exists, and is also continuous, so in short $g$ is a homeomorphism; it maps open to open, closed to closed. In particular, if $A in borel$, then $g(A) in borel$.

Recall that if $(a, b)$ an open interval that gets removed from the construction of $C$, then $f$ is constant and so $g$ will map $(a, b)$ to another open interval of the same length $b - a$. Thus, $
m(g([0, 1] \\ C)) = m([0, 1] \\ C) = 1.
$

Hence, $m(g(C)) = 2 - 1 = 1 > 0$, since $g (C union [0, 1]\\C) = [0, 2]$. Hence, there exists a $B subset.eq g(C)$ such that $B in.not cal(M)$, as per the previous proposition.

Let $A := g^(-1) (B)$; then $A subset.eq g^(-1) (g (C))= C$. Since $m(C) = 0$, $A in cal(M)$ and $m(A) = 0$. But, $A in.not borel$; if it were, then $g(A) = B in borel$, since $g$ "maintains" Borel sets, but $B$ is not even Lebesgue measurable and so this is a contradiction).

= Integration Theory

== Measurable Functions

We will be considering functions $f$ defined on $RR$ or some subset of $RR$ that could take positive or negative infinity as its value i.e. $
f : RR -> overline(RR) := RR union {- infinity, infinity},
$ where $overline(RR)$ the _extended real line_; we say $f$ is $overline(RR)$-valued. If $f$ never takes $infinity, -infinity$ for any $x in RR$, we say $f$ finite-valued, or just $RR$-valued.

For all $a in RR$, we consider inverse images $
f^(-1) ([-infinity, a)) := {x in RR : f(x) in [-infinity, a)} = {f < a},
$ remarking the inclusion of $-infinity$; similarly $
f^(-1) ((a, infinity]) :=  {x in RR : f(x) in (a, infinity]} = {f > a},
$ and so on, for any $B subset.eq RR$, $
f^(-1)(B) := {x in RR : f(x) in B} = {f in B}.
$ Remark that $
f^(-1) (B^c) &= (f^(-1) (B))^c\
f^(-1) (A sect B) &= f^(-1) (A) sect f^(-1) (B)\
f^(-1) (A union B) &= f^(-1) (A) union f^(-1) (B),
$ which extend naturally for countable unions/intersections.

#definition("Measurable Function")[
  $f : RR -> overline(RR)$ is _measurable_ if $forall a in RR$, $
  f^(-1) ([-infinity, a)) in cal(M).
  $
]

#proposition("Equivalent Definitions of Measurability")[
  $
  f "is measurable" &<=> forall a in RR, f^(-1) ([a, infinity]) in cal(M)\
    &<=> forall a in RR, f^(-1) ((a, infinity]) in cal(M)\
    &<=> forall a in RR, f^(-1) ([-infinity, a]) in cal(M)
  $
]

#proof[
  We prove just the last equivalence. Notice that $forall a in RR$, we can use the commuting of inverse images with countable unions, intersections, complement to write $
  f^(-1) ([-infinity, a)) &= union.big_(n=1)^infinity f^(- 1) ([-infinity, a - 1/n))
  $ and $
  f^(-1) ([-infinity, a]) = sect.big_(n=1)^infinity f^(-1) ([-infinity, a + 1/n)).
  $
]

#proposition[If $f$ finite-valued, Then
$
f "is measurable" &<=> forall a < b in RR, f^(-1) ((a, b)) in cal(M)\
&<=>  wide dots.c wide f^(-1) ((a, b]) in cal(M)\
&<=>  wide dots.c wide f^(-1) ([a, b)) in cal(M)\
&<=>  wide dots.c wide f^(-1) ([a, b]) in cal(M).
$
]

#definition("Extended Borel Sigma Algebra")[Define the Borel "extended" algebra $frak(B)_(overline(RR))$ of subsets of $overline(RR)$, defined by $
frak(B)_(overline(RR)) := sigma (borel union {{-infinity}, {infinity}}).
$
]
#proposition[
  $frak(B)_(overline(RR)) = sigma ({[-infinity, a) : a in RR})$.
]

#proof[
  For every $a in RR$, we may write $
  [-infinity, a) = underbrace((-infinity, a), in borel) union {-infinity} in frak(B)_(overline(RR)),
  $ so $sigma ({[-infinity, a) : a in RR}) subset.eq frak(B)_(overline(RR))$.

  Conversely, notice that $
  {-infinity} = sect.big_(n=1)^infinity [-infinity, -n),
  $ and $
  {infinity} = overline(RR) minus (union.big_(n=1)^infinity [-infinity, n)),
  $ so ${-infinity}, {infinity} in sigma ({[-infinity, a) : a in RR})$. Hence, for any $a in RR$, $
  (- infinity, a) = [-infinity, a) minus {-infinity} in sigma ({[-infinity, a) : a in RR}),
  $ and so $borel subset.eq sigma ({[-infinity, a) : a in RR})$. ${-infinity}, {infinity} in sigma ({[-infinity, a) : a in RR})$ already, and thus $frak(B)_(overline(RR)) subset.eq sigma ({[-infinity, a) : a in RR})$.
]

#proposition[$f : RR -> overline(RR)$ measurable $<=>$ for all $B in frak(B)_(overline(RR)), f^(-1) (B) in cal(M)$.]

#proof[
  $impliedby$ is immediate. For $=>$, let $cal(C)$ be a collection of subsets of $overline(RR)$, then put $
  f^(-1) (cal(C)) := {f^(-1)(B) : B in cal(C)}.
  $ By an assignment question (2.6), $
  f^(-1) (sigma (cal(C))) = sigma (f^(-1) (cal(C))).
  $ Take $cal(C) = {[-infinity, a) : a in RR}$. Then, $
  f^(-1) (sigma (cal(C))) = f^(-1) (frak(B)_(RRR)) = sigma (f^(-1) ({[-infinity, a) : a in RR})).
  $ But $f$ measurable, so $f^(-1) ([-infinity, a)) in cal(M)$ for each $a in RR$, hence sigma $(f^(-1) ({[-infinity, a) : a in RR})) subset.eq cal(M)$ and so $f^(-1) (sigma (cal(C))) subset.eq cal(M)$ completing the proof.
]

#corollary[If $f$ finite-valued, then $f$ is measurable $<=>$ for every $B in borel$, $f^(-1) (B) in cal(M)$.]

#proposition[Given $f : RR -> RRR$, define the _finite valued component_ of $f$ given by $
f_RR (x) := cases(f(x) : -infinity < f(x) < infinity, 0 "otherwise").
$ Then, $f$ measurable $<=>$ $forall B in borel$, $f^(-1)_RR (B) in cal(M)$ AND ${f = infinity}, {f = -infinity}$ both in $cal(M)$.]

#proof[
  ($impliedby$) For any $a in RR$, $
  f^(-1)([-infinity, a)) = {f = -infinity} union f^(-1) ((-infinity, a)) = {f = -infinity} union f^(-1)_RR ((-infinity, a)),
  $ a union of measurable sets and hence is itself measurable.

  ($=>$) Remark that ${f = infinity}, {f = -infinity} in cal(M)$ automatically. For any $B in borel$, we have $
  f^(-1)_RR (B)  = {x in RR : f_RR (x) in B} = {x in RR : f (x) in B, -infinity < f < infinity} union {x in RR : 0 in B,  f(x) = plus.minus infinity} in cal(M).
  $
]

#definition[If a statement is true for every $x in A$ where $A in cal(M)$ s.t. $m(A^c) = 0$, then we say the statement is true a.e. (almost everywhere).]

#proposition[If $f : RR -> RRR$ is measurable and $f = g$ a.e. then $g$ is measurable.]

#corollary[If $f$ is finite-valued a.e., then $f$ is measurable $<=>$ $f_RR$ is measurable $<=>$ $forall a < b in RR$, $f^(-1)((a, b)) in cal(M)$.]

#proposition[
  If $f equiv c$ then $f$ measurable. 
  
  If $f =bb(1)_A$ for some $A subset.eq RR$, then $f$ is measurable $<=>$ $A in cal(M)$.
]

#proof[
  Assume $f equiv c$. Then $
  f^(-1) ([-infinity, a)) = cases(RR  "if" c < a, nothing "if" c >= a) in cal(M).
  $ Assume now $f = bb(1)_A$. For all $a in RR$, $
  f^(-1) ([-infinity, a)) = cases(RR "if" a > 1, A^c "if" 0< a <= 1, nothing "if" a <= 0) in cal(M) <=> A in cal(M).
  $
]

#proposition[If $f$ is (finite-valued) continuous, then $f$ is measurable.]
#proof[
  $f : RR -> RR$ continuous $<=>$ for all $G subset.eq RR$ open, $f^(-1) (G)$ open. For all $a < b in RR$, then $f^(-1) ((a, b))$ open so $f^(-1) ((a, b)) in cal(M)$ so $f$ measurable.

  In fact, if $f : RR -> RR$ continuous, then for all $B in borel$, $f^(-1) (B) in borel$; $
  f^(-1) (borel) = f^(-1) (sigma ({"open sets"})) = sigma (underbrace(f^(-1) ({"open sets"}), "all open")) subset.eq sigma ({"open sets"}) = borel.
  $ Moreover, if $f^(-1)$ (inverse) exists and is continuous, then for any $B in borel$, $f(B) in borel$.
]

#proposition[
  If $f : RR -> RR$ is measurable and $g : RR -> RR$ is continuous, then $g compose f$ is measurable.
]

#remark[The order matters! The converse doesn't hold in general.]

#proof[
  For all $a in RR$, $
  (g compose f)^(-1) ((- infinity , a)) &= {x in RR : g(f(x)) < a} \
  &= {x in RR : f(x) in g^(-1) ([-infinity, a))}\
  &=f^(-1)(g^(-1)([-infinity, a))) in cal(M).
  $
]

#proposition[If $f : RR -> RRR$ is measurable, then:
+ for every $c in RR$, $c f$ is measurable (in particular $-f$ measurable);
+ $|f|$ is measurable;
+ for every $k in NN$, $f^k$ is a measurable. 
]

#proof[
  We prove just 3. If $k = 0$ this is trivial.  For any $a in RR$, $
  (f^k)^(-1) ([-infinity, a)) = cases(
    f^(-1)(\[-infinity, a^(1/k)\)) &"if" k "is odd",
    nothing &"if" k "is even and " a<= 0,
    f^(-1)(\[-a^(1/k), a^(1/k)\)) &"if" k "is even and" a > 0,
  ) in cal(M).
  $
]

#proposition[
  If $f, g$ are two finite-valued measurable functions, then $f + g$, $f dot g, f or g := max {f ,g}, f and g := min {f, g}$ are measurable functions, where $
  (f or g)(x) = max{f(x), g(x)}.
  $
]

#proof[
For all $a in RR$, $
  (f + g)^(-1) ([-infinity, a) &= {x in RR : f(x) + g(x) < a}\
  &= {x in RR : f(x) < a - g(x)}\
  &= union.big_(q in QQ) {x in RR : f(x) < q < a - g(x)}\
  &= union.big_(q in QQ) underbrace({x in RR : f(x) < q}, in cal(M)) sect underbrace({x in RR : g(x) < a - q }, in cal(M)) in cal(M). // TODO put something "in the middle" of f, g such that you can split the sets.
$ This implies, then, that $f - g$ measurable, as are $(f+g)^2$ and $(f-g)^2$, and thus $
f g = 1/4 [(f+g)^2 - (f - g)^2]
$ is measurable.

We have too that $
f or g = 1/2 (abs(f - g) + (f + g))
$ and so is measurable, and so $
f and g = - max{-f, - g} = - (-f or - g)
$ is measurable.
]

#corollary[
  If $f$ is measurable, then $f^plus := f or 0 = max{f, 0}$ and $f^minus := - (f and 0) = max{-f, 0}$ are measurable, as is $f and k$ for any $k in RR$.
]
#remark[
  Notice that $f = f^plus - f^minus$, even with "infinities", and $|f| = f^plus + f^minus$.
]

#proposition[
  Let ${f_n}$ be a sequence of measurable functions. Then, $sup_(n) f_n$, $inf_n f_n$, $limsup_(n->infinity) f_n$, and $liminf_(n->infinity) f_n$ are all measurable (where $(limsup_(n->infinity) f_n) (x) := limsup_(n->infinity) f_n (x) = inf_(m>=1) sup_(n>=m) f_n (x)=lim_(m->infinity) sup_(n>=m) f_n (x)$).
]

#proof[
  To show $sup_n f_n$ measurable, we will show for all $a in RR$ ${sup_n f_n <= a} in cal(M)$. $
  x in {sup_n f_n <= a} &<=> sup_n f_n (x) <= a <=> f_n (x) <= a forall n >= 1 <=> x in sect.big_(n=1)^infinity {f_n <= a},
  $ hence ${sup_n f_n <= a} = sect.big_(n=1)^infinity underbrace({f_n <= a}, in cal(M)) in cal(M)$ and hence $sup_n f_n$ is measurable. Note that using $<=$ was important; ${sup_n f_n < a} subset.neq sect.big_(n=1)^infinity {f_n < a}$, since the $sup_n f_n$ could equal $a$. We could say the following, however: $
  {sup_n f_n < a} = union.big_(k=1)^infinity {sup_n f_n <= a - 1/k} = union.big_(k=1)^infinity sect.big_(n=1)^infinity {f_n <= a - 1/k} in cal(M).
  $ Next, we have $inf_n f_n = - sup_n (- f_n)$ so we are done. // TODO compare {inf fn < a} and union {f_n < a} and the same with equalities

  For $limsup, liminf$, we have $
  limsup_n f_n = inf_(m >= 1) underbrace(sup_(n >= m) f_n, := g_m).
  $ $g_m$ is measurable for each $m >= 1$, hence $inf_m g_m$ is measurable, hence $limsup_n f_n$ is measurable. Similar logic follows for $liminf$.

  We could have show, more directly, that $
  {limsup_n f_n < a}&= {inf_(m >= 1) sup_(n>= m) f_n < a}\
  &= union.big_(m=1)^infinity {sup_(n>=m)  f_n < a}\
  &= union.big_(m=1)^infinity union.big_(k=1)^infinity {sup_(n>=m)  f_n <= a- 1/k}\ // turn strict inequality into nonstrict inequality!!
  &= union.big_(m=1)^infinity union.big_(k=1)^infinity sect.big_(n=m)^infinity { f_n <= a- 1/k}.
  $
  // TODO express {limsup f_n <, <= a} as a set, etc.
]

#proposition[
  Let ${f_n}$ be a sequence of measurable functions. Then, all of the following sets are also measurable:
  $
  &{x in RR : lim_(n->infinity) f_n (x) "exists in" RR} =: {lim_(n->infinity) f_n "exists in" RR},\
  &{lim f_n = infinity}, {lim f_n = -infinity}, {lim f_n = c in RR}.
  $ Moreover, if $lim_(n->infinity) f_n$ exists (in $RR$ or as $plus.minus infinity$) a.e. with $f = lim_(n->infinity) f_n$ a.e. then $f$ is measurable.
]

#proof[
We have $
{lim f_n "exists in" RR} &= {limsup f_n = liminf f_n "and" -infinity < limsup f_n < infinity}\
&= {-infinity < liminf f_n < infinity} sect {-infinity < limsup f_n < infinity} sect {limsup f_n - liminf f_n = 0} in cal(M).
$ Similarly, $
{lim f_n = c} &= {x in RR : forall k >= 1, exists n >= 1 st forall m>=n, |f_n (x) - c| <= 1/k}\
&= underbrace(sect.big_(k=1)^infinity, forall epsilon = 1/k > 0) underbrace(union.big_(n=1)^infinity, exists n >= 1) underbrace(sect.big_(m=n)^infinity, forall m >= n) {abs(f_n (x) - c) <= 1/k}.
$ // TODO rewrite using Cauchy sequence characterization.
]

== Approximation by Simple Functions

Given a function $f : RR -> RRR$, measurable, we may write $
f = f^plus - f^minus,
$ where $f^plus, f^minus$ are non-negative measurable functions; so, it suffices to study non-negative measurable functions. For any $n >= 1$, we have $
f_n^plus := (f^plus and n) dot bb(1)_([-n,n]),
$ i.e., we cap $f^plus$ at $n$, and disregard values of $f^plus$ outside of $[-n, n]$; hence we limit our view to a $2 n times n$ "box". Then, $f_n^plus$ is non-negative, measurable, bounded (by $n$), compactly supported (zero outside a bounded set), and in particular $f_n^plus arrow.t$, with limit $
lim_(n-> infinity) f_n^plus = f^plus.
$ An identical construction follows for $f^minus$ with $
f_n^minus := (f^minus and n) bb(1)_([-n,n]),
$ with $f_n^minus arrow.t$ and $
lim_(n->infinity) f_n^minus = f^minus.
$ Fix some $n$ and consider $f_n^plus$. For $k = 0, 1, 2, dots, 2^n n$, define $
A_(n, k) := {x in [-n,n] : k/(2^n) <= f_n^plus (x) < (k+1)/(2^n)} = {k/(2^n) <= f_n^plus <(k+1)/(2^n) } sect [-n, n]  in cal(M),
$ noting that $A_(n, k) sect A_(n, ell) = nothing$ if $k eq.not ell$. Set now $
phi_n := sum_(k=0)^(n dot 2^n) bb(1)_(A_(n,k)) k/(2^n) = sum_(k=0)^(n dot 2^n) cases(k/(2^n) "if in" A_(n,k), 0 "else").
$ We call $phi_n$ a "simple function"; more generally:

#definition[ $phi$ is a _simple function_ if $phi = sum_(k=1)^L bb(1)_(E_k) dot a_k$ where $L$ a positive integer, $a_k$'s are constant, $E_k$'s are measurable sets of finite measure.]

Moreover, note that $phi_n arrow.t$; at each new stage $n -> n+1$, the regions are cut in two, $A_(n, k) = A_(n + 1, 2k) union A_(n+1, 2k + 1)$. In addition, we have $phi_n <= f_(n)^plus <= f^plus$ for all $n$. Moreover, we have the following: 
#proposition[$
lim_(n->infinity) phi_n (x) = f^plus (x) $ for all $x in RR$.
]
#proof[
For all $x in RR$, for sufficiently large $n$ we have that $x in [-n ,n]$ and so $f^(plus) (x) = f^plus (x) bb(1)_([-n,n]) (x)$. Assume for now $f^(plus) < infinity$. Then, for sufficiently large(r?) $n$, we can ensure $f^(plus) (x) < n$ and so $f^(plus) (x) = f_(n)^plus (x)$ for such an $x$. Further, we have that $x in A_(n, k)$ for some $k$ so $phi_n (x) = k/(2^n)$ and $f_n^+ (x) < (k+1)/(2^n)$ and thus $
0 <= f_(n)^plus (x) - phi_n (x) < (k+1)/(2^n) - k/(2^n) = 2^(-n)
$ by construction and so $0 <= f^(plus) (x) - phi_n (x) <= 2^(-n)$ and thus $lim_(n->infinity) phi_n (x) = f^plus (x)$.

In the case that $f^(plus) (x) = infinity$, then $phi_n (x) = n$ for all sufficiently large $n$ hence $
lim_(n -> infinity) phi_n (x) = lim_(n->infinity) n = infinity = f^(plus) (x).
$
]

#theorem[If $g$ is measurable and non-negative, there exists a sequence of simple functions ${phi_n}$ such that $phi_n arrow.t$ and $lim_(n->infinity) phi_n (x) = g(x)$ for every $x in RR$.]

We can repeat this same construction and proof for $f^minus$ with a sequence $tilde(phi_n)$. Even better:

#theorem[If $f$ is measurable, then $exists$ a sequence of simple functions ${psi_n}$ such that $|psi_n| arrow.t$ and $|psi_n| <= |f|$ for all $n$ and for all $x in RR$, $lim_(n->infinity) psi_n (x) = f(x)$.]

#proof[
  Take $psi_n = phi_n - tilde(phi_n)$ as above; then for all $x in RR$, at least one of $phi_n (x), tilde(phi_n) (x)$ equals zero. Then $
  abs(psi_n) = phi_n + tilde(phi_n) < f^plus + f^minus = |f|,
  $ and $
  lim_(n->infinity) psi_n (x) = lim_(n -> infinity) phi_n (x) - lim_(n -> infinity) tilde(phi_n) (x) = f^plus - f^minus = f.
  $
]

#definition("Step Function")[
$theta$ a _step function_ if it takes the form $
theta (x) = sum_(k=1)^L a_k bb(1)_(I_k) (x),
$ where $L in NN, a_k$'s constant, and $I_k$ finite, open intervals.
]

#theorem[
  If $f$ is measurable, then there exists a sequence of step functions ${theta_n}$ such that $
  lim_(n->infinity) theta_n (x) = f(x) "for" bold("almost every") x in RR.
  $ In particular, we do not have pointwise convergence as for general simple functions, but we have convergence outside a zero-measure set.
]

#proof[
  Assume, wlog, that $f$ non-negative (by the previous construction, we can "split" $f$ if not and approximate its positive, negative parts). Given $A in cal(M)$ with finite measure, recall that for every $epsilon > 0$, there exists finitely many finite open intervals $I_1, dots, I_N$ such that $
  m(A triangle.t (union.big_(i=1)^N I_i))  < epsilon.
  $ By renaming/rearranging $I_i$'s if necessary, we may assume that $I_i$'s are disjoint; hence $
  bb(1)_(union.big_(i=1)^N I_i) = sum_(i=1)^N bb(1)_(I_i).
  $ Put $
    theta_A := sum_(i=1)^N bb(1)_(I_i),
  $ noting this is indeed a step function as the name suggests. Then, remark that $
  m underbrace(({ x in RR : bb(1)_A (x) eq.not theta_A (x)}), = A triangle.t (union.big_(n=1)^N I_i)) < epsilon.
  $ Since $f$ measurable and non-negative, $exists {phi_n}$ sequence of simple functions with limit $f$. In particular, $
  phi_n = sum_(k=0)^(n 2^n) k/(2^n) bb(1)_(A_(n, k)).
  $ Applying our above analysis to each $A_(n, k)$, then, we have that for any $n >= 1$ and $k = 0, 1, dots, n 2^(n)$ we can find a step function $theta_(n, k)$ such that $
  m ({ x in RR : bb(1)_(A_(n, k)) eq.not theta_(n, k) (x)}) < 1/(2^n (n 2^n + 1)) thin thin (\" = epsilon \").
  $ Put then $
  theta_n :=  sum_(k=0)^(n 2^n) k/(2^n) theta_(n, k),
  $ which is itself a step function. Put $
  E_n := {x in RR : theta_n (x) eq.not phi_n (x)}.
  $ Then, $
  m(E_n) <= m(union.big_(k=0)^(n 2^n) {theta_(n, k) eq.not bb(1)_(A_(n, k))}) <= sum_(k=0)^(n 2^n) m({theta_(n, k) eq.not bb(1)_(A_(n,k))}) <= 2^(-n).
  $ The $phi_n$'s are chosen such that $forall x in RR$, $|phi_n (x) - f_n (x)| <= 1/(2^n)$. Putting $
  F_n := {x in RR : |theta_n (x) - f_n (x) | > 2^(-n)},
  $ then remark that $F_n subset.eq E_n$ so $m(F_n) <= 1/(2^n)$. 

  We claim now that for a.e. $x in RR$, $exists m >= 1$ such that $forall n >= m$, $|theta_n (x) - f_n (x)| <= 1/(2^n)$, remarking that such an $m$ is _dependent_ on $x$. Consider the complement of this statement; if this set has measure 0, we are done. The logical negation would be "for every $m >= 1$, exist $n >= m$ such that $|theta_n (x) - f_n (x) | > 2^(-n)$", which is equivalent to the set $
  sect.big_(m=1)^infinity union.big_(n=m)^infinity { x in RR : |theta_n (x) - f_n (x)| > 2^(-n)} = sect.big_(m=1)^infinity union.big_(n=m)^infinity F_n.
  $ Let $B_m := union.big_(n=m)^infinity F_n$; notice $B_m arrow.b$. Then, by continuity from above $thin^(ast ast ast ast)$
  // TODO some issues if infinite here
   $
  m( sect.big_(m=1)^infinity union.big_(n=m)^infinity F_n) = lim_(m->infinity) m(B_m) <= lim_(m-> infinity) sum_(n=m)^infinity m(F_n) <= lim_(m-> infinity) sum_(n=m)^infinity 1/(2^n) = 0,
  $ since the tail of a convergent series must converge to zero. Hence, the set has measure 0 as desired so for almost every $x in RR$ there exists $m >= 1$ such that for all $n >= m$, $|theta_n - f_n| <= 1/(2^n)$, hence almost every where $lim_(n->infinity)( theta_n - f_n) = 0$. Therefore, almost everywhere, $
  theta_n = (theta_n - f_n) + f_n -->^(n-> infinity) f.
  $
]
In this proof, we have proven (and then used) more generally:

#lemma("Borel-Cantelli Lemma")[
  If ${F_n} subset.eq cal(M)$ such that $sum_(n=1)^infinity m(F_n) < infinity$, then $
  m(sect.big_(m=1)^infinity union.big_(n=m)^infinity F_n) = 0.
  $
]

#proof[
  Remark that $union.big_(n=m)^infinity F_n$ a decreasing sequence of functions indexed by $m$. By continuity of the measure and subadditivity, $
  m(sect.big_(m=1)^infinity union.big_(n=m)^infinity F_n) = lim_(m->infinity) m(union.big_(n=m)^infinity F_n) <= lim_(m->infinity) sum_(n=m)^infinity m(F_n) = 0,
  $ since the tail of a converging sequence must converge to zero.
]


== Convergence Almost Everywhere vs Convergence in Measure

#definition("Convergence Almost Everywhere")[For measurable functions ${f_n}$, $f$ we say $f_n$ converges to $f$ a.e. and write $f_n -> f "a.e."$  if for almost every $x in RR$, $lim_(n-> infinity) f_n (x) = f(x)$.

Similarly, we say $f_n -> f$ a.e. on $A$ if $exists B subset.eq A$ with $m(B) = 0$ such that $forall x in A minus B$, $lim_(n->infinity) f_n (x) = f(x)$.]

#definition("Convergence in Measure")[For measurable, finite-valued functions ${f_n}$, $f$ we say $f_n$ converges to $f$ in measure and write $f_n -> f "in measure"$ if for every $delta > 0$, $
lim_(n-> infinity) m({x in RR : |f_n (x) - f(x)| >= delta}) = 0.
$ 

Similarly, we say $f_n -> f$ in measure on $A$ if $forall delta > 0$, $lim_(n->infinity) m({x in A : |f_n (x) - f(0)| >= delta}) =0$.
]

#proposition[
  Given finite-valued measurable functions ${f_n}, f$ and $A in cal(M)$ with finite measure, then if $f_n -> f$ a.e. on $A$, then $f_n -> f$ in measure on $A$.
]

#proof[
  For all $delta > 0$, $
  sect.big_(m=1)^infinity union.big_(n=m) {x in A : |f_n (x) - f(x)| > delta} subset.eq {x in A : lim_(n->infinity) f_n (x) eq.not f(x)}.
  $ The set on the RHS has measure zero and thus so does the left one. Then, $
  lim_(m -> infinity) m(union.big_(n=m) {x in A : |f_n (x) - f(x)| > delta}) = 0
  $ by continuity, and $
  {|f_m - f| > delta} subset.eq union.big_(n =m)^infinity {|f_n - f| > delta}
  $ hence $m({|f_m - f| > delta}) <= m(union.big_(n =m)^infinity {|f_n - f| > delta}) -->^(m-> infinity) 0$.
]

#example[
We give an example of why the assumption that $m(A) < infinity$ is necessary. Let, $f_n = bb(1)_([n, infinity))$ and $f equiv 0$. Then, $lim_(n->infinity) f_n (x) = f(x)$ for every $x in RR$. But $m({x in RR : |f_n (x) - f(x)| = 1}) = m([n, infinity)) = infinity$.

In general, the converse statement $f_n -> f$ in measure does _not_ imply that $f_n -> f$ almost everywhere, even on finite measure sets. Put $phi_(1, 1) = bb(1)_([0, 1))$, $phi_(2, 1) = bb(1)_([0, 1/2))$, $phi_(2, 2) = bb(1)_([1/2, 1))$, $phi_(3, 1) = bb(1)_([0, 1/3))$, $phi_(3, 2) = bb(1)_([1/3, 2/3))$, $phi_(3, 3) = bb(1)_([2/3, 1))$, or in general $phi_(k, j) = bb(1)_([(j-1)/k, j/k))$ for $j = 1, dots, k$. Reorder $phi_(k, j)$ "lexicographically" into ${f_n}$. Then, we claim $f_n -> 0$ in measure on $[0, 1)$; for any $delta in (0, 1)$, $
m ({|f_n - 0| > delta}) = 1/
(k(n)) -> 0,
$ where $k(n)$ the "row" that $f_n$ comes from. Hence, $f_n$ converges in measure. However, $f_n$ does not converge almost eveywhere on $[0, 1)$. Indeed, for each $x in RR$ and $k >= 1$, there exists a _unique_ $j$ such that $x in [(j-1)/k, j/k]$ hence $phi_(k,j) (x) = 1$, so in other notation there always exists an $n$ such that $f_n (x) = 1$, and so precisely $f_n (x) = 1$ for infinitely many $n$. Hence, we do not have convergence everywhere (in fact, anywhere).
]

// Pagella
// $cal(A) cal(B) cal(C) cal(D) cal(E) cal(F) cal(G) cal(H) cal(I) cal(J) cal(K) cal(L) cal(M) cal(N) cal(O) cal(P) cal(Q) cal(R) cal(S) cal(T) cal(U) cal(V) cal(W) cal(X) cal(Y) cal(Z)$

// Bonum
// #show math.equation: set text(font: "TeX Gyre Bonum Math") 
// $cal(A) cal(B) cal(C) cal(D) cal(E) cal(F) cal(G) cal(H) cal(I) cal(J) cal(K) cal(L) cal(M) cal(N) cal(O) cal(P) cal(Q) cal(R) cal(S) cal(T) cal(U) cal(V) cal(W) cal(X) cal(Y) cal(Z)$

// Termes
// #show math.equation: set text(font: "TeX Gyre Termes Math") 
// $cal(A) cal(B) cal(C) cal(D) cal(E) cal(F) cal(G) cal(H) cal(I) cal(J) cal(K) cal(L) cal(M) cal(N) cal(O) cal(P) cal(Q) cal(R) cal(S) cal(T) cal(U) cal(V) cal(W) cal(X) cal(Y) cal(Z)$

// DejaVu
// #show math.equation: set text(font: "TeX Gyre DejaVu Math") 
// $cal(A) cal(B) cal(C) cal(D) cal(E) cal(F) cal(G) cal(H) cal(I) cal(J) cal(K) cal(L) cal(M) cal(N) cal(O) cal(P) cal(Q) cal(R) cal(S) cal(T) cal(U) cal(V) cal(W) cal(X) cal(Y) cal(Z)$

// Schola
// #show math.equation: set text(font: "TeX Gyre Schola Math") 
// $cal(A) cal(B) cal(C) cal(D) cal(E) cal(F) cal(G) cal(H) cal(I) cal(J) cal(K) cal(L) cal(M) cal(N) cal(O) cal(P) cal(Q) cal(R) cal(S) cal(T) cal(U) cal(V) cal(W) cal(X) cal(Y) cal(Z)$

#proposition[Given ${f_n}$, $f$ measurable, finite-valued functions, if $f_n -> f$ in measure, then there exists a subsequence ${f_(n_k)}$ such that $f_(n_k) -> f$ a.e. as $k -> infinity$.]

#proof[
  Assume $f_n -> f$ in measure, that is for every $delta > 0$, $m({|f_n - f| > delta}) -> 0$. Hence, for all $k >= 1$, with $delta = 1/k$, we have that for some sufficiently large $n_k$, we have that $m(underbrace({|f_(n_k) - f| > 1/k}, := A_k)) <= 1/(k^2)$, hence $sum_(k=1)^infinity m(A_k) < infinity$. Hence, $
  m(sect.big_(ell=1)^infinity union.big_(k=ell)^infinity A_k) = lim_(ell -> infinity) m(union.big_(k=ell)^infinity A_k) <= lim_(ell -> infinity) sum_(k=ell)^infinity m(A_k) = 0,
  $ since $sum_(k=ell)^infinity m(A_k)$ the tail of a converging series. Hence, complementing the above, a.e. there $exists ell$ such that for every $k >= ell$, $|f_(n_k) - f| <= 1/k$ and so $lim_(k->infinity) |f_(n_k) - f| = 0$ almost everywhere, and so $f_(n_k) -> f$ a.e. (as $k-> infinity$).
]

#proposition("Subsequence Test")[
Given ${f_n}$, $f$ measurable, finite-valued functions, $f_n -> f$ in measure $<=>$ for every subsequence ${n_k}$, there exists a subsubsequence ${n_(k_ell)} subset {n_k}$ such that $f_(n_(k_ell)) -> f$ in measure as $ell -> infinity$.
]

#proof[
$=>$ is clear. For $impliedby$, suppose towards a contradiction that $f_(n) arrow.not f$ in measure. Then, $exists delta > 0$ and subsequence ${n_k}$ $m({|f_(n_k) - f| > delta}) > delta$ for every $k$. By the assumption of the RHS, there exists a further subsequence ${n_(k_ell)}$ such that $f_(n_k_ell) -> f$ in measure. This is a contradiction.
]

#example("Assignment Exercise")[
  Prove that if $f_n -> f$ in measure and $g_n -> g$ in measure, $f_n g_n -> f g$ in measure (everything finite valued, measurable).
]

== Egorov's Theorem and Lusin's Theorem

Recall that if $f$ is measurable, then $exists {theta_n}$ sequence of step functions such that $theta_n -> f$ almost everywhere.

#theorem("Egorov's")[
  Given ${f_n}$, $f$ measurable functions and $A in cal(M)$ with $m(A) < infinity$, if $f_n -> f$ a.e. on $A$, then $forall epsilon > 0$, there exists a closed subset $A_epsilon subset.eq A$ with $m(A \\ A_epsilon) <= epsilon$ such that $f_n -> f$ uniformly on $A_epsilon$.
]

#proof[
  We assume first $f$ is finite-valued on $A$ (otherwise, replace $A$ with $A sect {-infinity < f < infinity}$; we'll deal with ${f = plus.minus infinity}$ later). We want to show that $forall epsilon > 0, exists$ closed $A_epsilon subset.eq A$ s.t. $m(A \\ A_epsilon) < epsilon$ _and_ $sup_(x in A_epsilon) |f_n (x) - f(x)| -> 0$ as $n -> infinity$.

  For each $k >= 1$ and $n >= 1$, put $
  E^((k))_n := {x in A : |f_j (x) - f(x)| <= 1/k forall j >= n}.
  $ For fixed $k$, remark that $E_n^((k)) subset.eq E_(n+1)^((k))$, i.e. $E_n^((k))$ increasing (wrt $n$), so we may consider $
  union.big_(n=1)^infinity E_(n)^((k)) = {x in A : exists n >= 1 "s.t." forall j >= n, |f_j (x) - f(x) | <= 1/k} supset.eq {x in A : lim_(n->infinity) f_n (x) = f(x)} =: A'.
  $ By assumption, $m(A') = m(A)$, so by continuity and the superset relation above, $m(A) = m(A') <= m(union.big_(n=1)^infinity E_(n)^((k))) = lim_(n->infinity) m(E_(n)^((k))) <= m(A)$, and thus $lim_(n->infinity) m(E_(n)^((k))) = m(A)$ for every $k >= 1$.

  Given, then, any $epsilon > 0$, there exists a $n_k$ such that $m(A \\ E_(n_k)^((k))) = m(A) -  m(E_(n_k)^((k))) < 1/(2^k) epsilon/2$. Set $
  B := A \\ (sect.big_(k=1)^infinity E_(n_k)^((k))),
  $ then $
  m(B) = m(union.big_(k=1)^infinity A \\ E_(n_k)^((k))) <= sum_(k=1)^infinity m(A \\ E_(n_k)^((k))) <= epsilon/2.
  $ Put $
  tilde(A) := A \\ B = sect.big_(k=1)^infinity E_(n_k)^((k)). 
  $ Then, if $x in tilde(A)$, then $x in E_(n_k)^((k))$ for every $k$, and hence for every $k >= 1$ and $j >= n_k$, $|f_j (x) - f(x)| <= 1/k$. This shows then that $f_n -> f$ uniformly on $tilde(A)$. By regularity of $m$, there exists a closed $A_(epsilon) subset.eq tilde(A)$ such that $m(tilde(A) \\ A_epsilon) <= epsilon/2$. Then, $f_n -> f$ uniformly on $A_epsilon$, and $m(A \\ A_epsilon) = m(A\\ tilde(A)) + m(tilde(A) \\ A_epsilon) < epsilon$.

  Now, if $f = infinity\/-infinity$ on $A$, then $A = A^(infinity) union A^(-infinity) union A^RR$ (with $A^bullet := {f = bullet} sect A$). The last case is done. For $A^infinity$ (similar construction for $A^(-infinity)$), define for every $k$, $n >= 1$,$
  E_n^((k)) := {x in A : f_j (x) > k forall j >= n}.
  $ Then, the remainder of the proof follows precisely the same for the sequence of sets $E_(n)^((k))$.
]

#remark[
  1. The assumption $m(A) < infinity$ is necessary. For instance $f_n = bb(1)_([n, infinity)) -> 0$ pointwise, but for any $a in RR$, $f_n$ does not converge to $0$ uniformly on $(a, infinity)$.
  2. In general, Egorov's $arrow.double.not f_n -> f$ uniformly a.e.. For instance, on $[0, 1]$, let $f_n (x) = x^n$ and $f(x) equiv 0$. For every $x in [0, 1)$, $f_n (x) -> f(x)$ as $n -> infinity$. Hence, $f_n -> f$ a.e. on $[0, 1]$ (the only point that doesn't converge, indeed, is at $1$). If $A subset.eq [0, 1]$ is closed such that $1 in A$, then $f_n arrow.not f$ uniformly on $A$. To see this, let ${x_m} subset.eq A$ such that $x_m arrow.t$ and $lim_(m->infinity) x_m = 1$. Then, for any fixed $n$, $
  sup_(x in A)|f_n (x) - f(x)| >= sup_(m)|f_n (x_m) - f(x_m)| = sup_m x_m^n = 1,
  $ hence $f_n$ does not converge uniformly on $A$.
]

#theorem("Lusin's Theorem")[
  Given $f$ measurable and finite-valued and $A in cal(M)$ with $m(A) < infinity$, for all $epsilon > 0$, there exists a closed $A_epsilon subset.eq A$ with $m(A\\A_epsilon) < epsilon$ such that $f|_(A_epsilon)$ is continuous.
]

#remark[Lusin's Theorem states that $f|_(A_(epsilon))$ is continuous as a function on $A_epsilon$, which is _not_ the same as saying $f$ as a function on $A$ is continuous at points in $A_epsilon$.

For instance, $f = bb(1)_(QQ sect [0, 1])$ is not continuous anywhere on $[0, 1]$. However, $f|_(QQ sect [0, 1])$ is constant and therefore continuous _on_ $QQ sect [0, 1]$.
]

#proof[
  Let ${theta_n}$ be a sequence of step functions such that $theta_n -> f$ a.e. on $A$. Note that $theta_n$ piecewise constant and hence piecewise continuous. Given $epsilon > 0$ and $n >= 1$, we can find an open set $E_n$ such that $theta_n|_(E_n^c)$ is continuous and $m(E_n) <= epsilon/2 1/2^n$. Meanwhile, Egorov's implies that there exists a closed $B subset.eq A$ such that $m(A \\ B) <= epsilon/2$ such that $theta_n -> f$ uniformly on $B$. Set $
  A_epsilon = B \\ union.big_(n=1)^infinity E_n,
  $ noting that $A_epsilon subset A$ closed and $
  m(A\\A_epsilon) = m(A\\B) + m(union.big_(n=1)^infinity E_n) =  epsilon/2 + sum_(n=1)^infinity m(E_m) <= epsilon.
  $ Finally, on $A_epsilon$, $theta_n -> f$ uniformly and $theta_n|_(A_epsilon)$ continuous, and hence $f|_(A_epsilon)$ continuous (uniform limit of continuous functions is continuous).
]

#remark[
  1. Lusin's Theorem $arrow.double.not$ $f$ is continuous almost everywhere in general. For instance, recall that fat Cantor set $tilde(C)$, with $m(tilde(C)) = 1/2$. Let $f = bb(1)_tilde(C)$. $f$ is NOT continuous a.e. on $[0, 1]$, i.e. $forall B subset.eq [0, 1]$ with $m(B) = 1$, $f|_B$ is NOT continuous. To see this, let $tilde(D) = [0, 1] \\ tilde(C)$. Since $m(B) = 1$, then $m(tilde(C) sect B) = m(tilde(D) sect B) = 1/2$. Then for any $x in tilde(C) sect B$, $f|_B$ is NOT continuous at $x$. If it were at say some $x_0 in tilde(C) sect B$,  then there must exist some $delta > 0$ such that for any $x in (x_0 - delta, x_0 + delta) sect B$, $|f(x) - f(x_0)| < 1/2$. Hence, for any $x in (x_0 - delta, x_0 + delta) sect B$, $1/2 <= f(x) <= 3/2$. However, $m((x_0 - delta, x_0 + delta) sect B sect tilde(D)) > 0$ so it must be that $exists y in (x_0 - delta, x_0 + delta) sect B sect tilde(D) => f(y) = 0$, a contradiction. How, then, does one apply Lusin's; that is, $forall epsilon > 0$, there must exist some $A_epsilon subset.eq [0, 1]$ such that $m([0, 1] \\ A_epsilon) < epsilon$ and $f|_(A_epsilon) < epsilon$ (exercise)?
  2. (Exercise) The ${theta_n}$'s are not continuous on $RR$, but you can choose a sequence ${tilde(theta_n)}$ to be continuous on $RR$ such that $tilde(theta_n) -> f$ a.e..
  3. Lusin's Theorem $=>$ $forall k$ sufficiently large, $exists A_k subset.eq A$ closed such that $m(A \\ A_k) <= 1/k$ and $f|_(A_k)$ continuous on $A_k$. In fact, we can construct them such that $A_k arrow.t$ (otherwise replace $A_k$ with $union.big_(i=1)^k A_i$).
]

== Construction of Integrals

=== Integral of Simple Functions

#definition[
  Given a simple function $phi = sum_(k=1)^L a_k bb(1)_(E_k)$, the _(Lebesgue) integral_ of $phi$ is defined as $
  integral_RR phi(x) dif x = integral_RR phi := sum_(k=1)^L a_k dot m(E_k).
  $ For any $A in cal(M)$, $bb(1)_A phi$ is again a simple function and we define $
  integral_A phi := integral_RR bb(1)_A phi.
  $
]

#proposition([Properties of $integral_RR phi$])[
+ (Well-definedness) The written representation of $phi$ is not necessarily unique, but if $phi = sum_(k=1)^L a_k bb(1)_E_k = sum_(ell=1)^M b_ell bb(1)_F_ell$, then $
sum_(k=1)^L a_k m(E_k) = sum_(ell=1)^M b_ell m(F_ell).
$
+ (Linearity) If $phi, psi$ two simple functions and $a, b in RR$, then $a phi + b psi$ a simple function, and $
integral_RR a phi + b psi = a dot integral_RR phi + b dot integral_RR psi.
$ 
+ (Finite Additivity) If $phi$ a simple function, $A, B in cal(M)$ with $A sect B = nothing$, then $
integral_(A union B) phi = integral_A phi + integral_B phi.
$
+ (Monotonicity) If $phi, psi$ are two simple functions with $phi <= psi$, then $integral_RR phi <= integral_RR psi$.
+ If $phi$ a simple function then so is $|phi|$ and $|integral_RR phi| <= integral_RR |phi|$.
]

#proof[
1. wlog, we may assume $E_k$ and $F_ell$ are respectively disjoint. Set $a_0 = b_0 = 0$, $E_0 := (union.big_(k=1)^L E_k)^c, F_0 := (union.big_(ell=1)^M F_ell)^c$ for convenience. Now, ${E_0, dots, E_L}, {F_0, dots, F_M}$ are two partitions of $RR$. In particular, then, for each $k$, $bb(1)_E_k = sum_(ell=0)^M bb(1)_(E_k sect F_ell)$, since $E_k = union.big.sq_(ell=0)^M (E_k sect F_ell)$. Now, we have $
phi = sum_(k=0)^L a_k bb(1)_(E_k) = sum_(k=0)^L sum_(ell=0)^M a_k bb(1)_(E_k sect F_ell).
$ Similarly partitioning, we have $
phi = sum_(ell=0)^M b_ell bb(1)_(F_ell) =  sum_(ell=0)^M sum_(k=0)^L b_ell bb(1)_(E_k sect F_(ell)).
$ If $E_k sect F_ell eq.not nothing$, then $a_k = b_ell$, and thus on the one hand$
integral_RR phi =  sum_(k=0)^L sum_(ell=0)^M a_k m(E_k sect F_ell)
$ and on the other $
integral_RR phi =  sum_(ell=0)^M sum_(k=0)^L b_ell m(E_k sect F_(ell)),
$ (with summation convention $0 dot infinity = 0$). If $m(E_k sect F_ell) > 0$, then $E_k sect F_ell eq.not nothing$ and so $a_k = b_ell$ and so the two sums agree.
4. Assume $phi = sum_(k=1)^L a_k bb(1)_(E_k), psi = sum_(ell = 1)^M b_ell bb(1)_(F_ell)$. Repeat the partitioning/rewriting steps from part 1, then note that since $phi <= psi$, if $E_k sect F_ell eq.not nothing$, it must be that $a_k <= b_ell$, so if $m(E_k sect F_ell) > 0$ $a_k <= b_ell$ and thus the monotonicity follows.
]


=== Integral of Non-Negative Functions

#definition[
  If $f$ a non-negative, measurable function then the integral of $f$ is given by $
  integral_RR f(x) dif x = integral_RR f := sup{integral_RR phi :  phi "is simple and" phi <= f}.
  $
]

#proposition[The definition above agrees with that for simple functions that are also non-negative, namely this definition is consistent with the previous.]

#proof[
  Let $phi$ be non-negative. Then $phi <= phi$ certainly so the first definition $integral_RR phi <= sup {dots.c}$. Conversely, it suffices to show that for any non-negative simple $psi <= phi$, $integral_RR psi <= integral_RR phi$, using the first definition. But this simply follows from monotonicity of $integral$, and we are done.
]

#remark[
  Given $f >= 0$ and measurable, this definition implies that there exists a sequence ${phi_n}$ of simple functions such that $phi_n <= f$ and $lim_(n-> infinity) integral_RR phi_n = integral_RR f$. We would like to show that, in some sense, the choice of ${phi_n}$ is arbitrary.
]

#theorem[Suppose $f >= 0$ and measurable. If ${phi_n}$ a sequence of simple functions such that $phi_n arrow.t$ and $lim_(n->infinity) phi_n = f$ pointwise, then $
lim_(n->infinity) integral_RR phi_n = integral_RR f.
$]

#proof[
  Since $phi_n <= f$ for all $n >= 1$, then $integral_RR phi_n <= integral_RR f$ and so $lim_(n->infinity) integral_RR phi_n <= integral_RR f$ (nothing the limit on the LHS necessarily always exists by monotonicity). On the other hand, it suffices to show that $forall psi <= f$ simple, that $integral_RR psi <= lim_(n->infinity) integral_RR phi_n$. Assume $psi = sum_(k=1)^L a_k bb(1)_(E_k) = sum_(k=0)^L a_k bb(1)_(E_k)$ where ${E_0, dots, E_L}$ forms a partition of $RR$. Since $
  integral_RR psi = sum_(k=0)^L a_k m(E_k)
  $ and $
  integral_RR phi_n = sum_(k=0)^L integral_(E_k) phi_n
  $ by finite additivity. It suffices to show then that for each $k = 0, dots, L$, $a_k m(E_k) <= lim_(n->infinity) integral_E_k phi_n$.

  First, if $a_k = 0$ or $m(E_k) = 0$, then we are done. Assume $a_k, m(E_k) > 0$. For each fixed $k$, $lim_(n->infinity) phi_n = f >= psi$ so for every $x in E_k$, $lim_(n -> infinity) phi_n (x) >= psi(x) = a_k$. For any $epsilon > 0$, put $
  C_n^epsilon := {x in E_k : phi_n (x) >= (1 - epsilon) a_k}.
  $ Since $phi_n <= phi_(n+1)$, $C_n^epsilon arrow.t$ wrt $n$. Then note $
  union.big_(n=1)^infinity C_n^epsilon = E_k.
  $ Then, $
  lim_(n->infinity) integral_E_k phi_n = lim_(n->infinity) integral_RR bb(1)_(E_k) phi_n >= lim_(n->infinity) integral_RR bb(1)_(C_n^epsilon) phi_n >= lim_(n->infinity) (1- epsilon) a_k m(C_n^epsilon) = (1 - epsilon)a_k m(E_k), 
  $ where we use the fact that $bb(1)_(E_k)phi_n >= bb(1)_(C_n^epsilon) phi_n >= ( 1- epsilon) a_k bb(1)_(C_k^epsilon)$ and $lim_(n->infinity) m(C_n^epsilon) = m(union.big_(n=1)^infinity C_n^epsilon) = m(E_k)$. Since $epsilon$ arbitrary, then $
  lim_(n->infinity) integral_E_k phi_n >= a_k m(E_k),
  $ and we are done.
]

#corollary[
 For any $f >= 0$ measurable, if $forall n >= 1, k = 0, 1, dots, n 2^n$  with $A_(n, k) := {k/(2^n) <= f < (k+1)/(2^n)}$, then $
 integral_RR f = lim_(n->infinity) sum_(k=0)^(n 2^n) k/(2^n) m(A_(n,k)).
 $
]
#proof[
  Let $phi_n = sum_(k=0)^(n 2^n) k/(2^n) bb(1)_(A_(n, k))$, then $phi_n arrow.t$ and $phi_n -> f$.
]

#proposition("Properties of Integral of Non-Negative Functions")[
  1. (Well-definedness) If $f, g >= 0$ measurable such that $f = g$ a.e., then $integral_RR f = integral_RR g$.
  2. (Linearity) For any $f, g >= 0$ measurable and $a, b >= 0$, then $integral_RR (a f + b g) = a integral_RR f + b integral_RR g$.
  3. (Monotonicity) If $f, g >= 0$ measurable and $f <= g$ a.e., then $integral_RR f <= integral_RR g$.
  4. i. Let $f >= 0$ measurable, then $integral_RR f = 0 <=> f equiv 0$ a.e.\
    ii. Let $f >= 0$ measurable, $A in cal(M)$. Then $integral_A f = 0 <=> $ either $f equiv 0$ a.e. on $A$ or $m(A) = 0$.\
    iii. Let $f >= 0$ measurable, then if $integral_RR f < infinity$ then $f$ is finite valued a.e.
  5. (Markov's Inequality) Let $f >= 0$ measurable and $0 < a < infinity$. Then, $m({f > a}) <= 1/a integral_RR f$. In particular, if the RHS is finite, $lim_{a -> infinity} m({f > a}) = 0$, in fact in $cal(O)(1/a)$.
]

#proof[
1. Let ${phi_n}, {psi_n}$ sequences of simple functions such that both are monotonically increasing with $phi_n -> f, psi_n -> g$. Put $h_n := phi_n bb(1)_({f = g}) + psi_n bb(1)_({f eq.not g})$; then $h_n$ again simple, $h_n arrow.t$, and $h_n -> g$ everywhere. Then, $
integral_RR g = lim_n integral_RR h_n &= lim_n (integral_{f = g} phi_n + integral_{f eq.not g} psi_n)= lim_n integral_{f = g} phi_n.
$ Meanwhile, $
integral_RR f  = lim_n integral_RR phi_n = lim_n (integral_{f = g} phi_n + integral_{f eq.not g} phi_n) = lim_n integral_{f = g} phi_n,
$ and so $integral_RR f = integral_RR g$.
2. Take ${phi_n}, {psi_n}$ as in the previous proof. Then ${h_n : a phi_n + b psi_n}$ again a sequence of monotonically increasing simple functions with limit $a f + b g$. Then $
integral_RR (a f + b g) = lim_n integral_RR h_n = lim_n integral_RR (a phi_n + b psi_n)= lim_n (a integral_RR phi_n + b integral_RR psi_n) = a integral_RR f + b integral_RR g.
$
3. wlog, assume that $f <= g$ everywhere by replacing $f$ with $f bb(1)_{f <= g}$. Then, ${phi : "simple", phi <= f} subset.eq {phi : "simple", phi <= g}$ and so $integral_RR f <= integral_RR g$.
4.
  i. $impliedby$ clear. Conversely, we would like to prove that if $A = {f > 0}, m(A) = 0$. Put $A_n := {f >= 1/n}$ for $n >= 1$. Then, $A_n arrow.t$ and $union.big_(n=1)^infinity A_n = A$. By continuity of $m$, $
m(A) = lim_n m(A_n).
$ Suppose towards a contradiction that $m(A) = delta > 0$. Then, $delta = lim_n m(A_n)$, and so must exist $N >= 1$ such that $m(A_N) >= delta/2$. Since $f >= f bb(1)_(A_N) >= 1/N bb(1)_(A_N)$. By monotonicity, $integral_RR f >= integral_RR 1/N bb(1)_(A_N) = 1/N m(A_N) >= 1/N delta/2 > 0$, a contradiction.\
  ii. By i., $integral_A f = 0 <=> bb(1)_A f equiv 0$ a.e. on $RR$. If $m(A) = 0$, then $bb(1)_A equiv 0$ a.e. so $bb(1)_A f equiv 0$ a.e.. Else, if $m(A) > 0$, then $f equiv 0$ a.e. on $A$.\
  iii. Put $A := {f = infinity}$. Assume towards a contradiction that $m(A) = delta > 0$. Then, for every $n >= 1$, $f >= f bb(1)_A >= n bb(1)_A$ and so $integral_RR f >= integral_RR n bb(1)_A = n m(A) = n delta$. But this holds for any arbitrary $n$, so $integral_RR f = infinity$, a contradiction.
  5. Put $A_a := {f > a}$. Then $f >= f bb(1)_A_a > a bb(1)_A_a$ so $integral_RR f >= a m(A_a)$.
]

=== Integral of General Measurable, Integrable Functions

#definition[For $f$ measurable, $integral_RR f := integral_RR f^+ - integral_RR f^-$, provided that at least one of $integral_RR f^+$, $integral_RR f^-$ is finite; in particular, $integral_RR f$ may be finite or infinite.]

#remark[Only having $integral_RR f$ being defined is not sufficient for the desirable properties (linearity, monotonicity) to hold.]

#definition("Integrable")[A measurable function $f$ is called _integrable_, denoted $f in L^1 (RR)$, if _both_ $integral_RR f^+ < infinity$ and $integral_RR f^- < infinity$. Note that $
f in L^1 (RR) &<=> integral_RR |f| < infinity "(since" integral_RR |f| = integral_RR f^+ + integral_RR f^-")"\
&<=> integral_RR f "finite valued".
$]

#proposition("Properties of Integrals of Integrable Functions")[
1. $|integral_RR f| <= integral_RR |f|$
2. $f in L^1 (RR) => f$ is finite valued a.e.
3. (Linearity) For $f, g in L^1 (RR)$ and $a, b in RR$, $a f + b g in L^1 (RR)$ and $integral_RR (a f + b g) = a integral_RR f + b integral_RR g$
4. If $f in L^1 (RR)$ and $A in cal(M)$ and $m(A) = 0$ then $integral_A f = 0$; in particular if $f, g in L^1(RR)$ with $f = g$ a.e. then $integral_RR f = integral_RR g$
5. (Monotonicity) If $f, g in L^1(RR)$ with $f <= g$ a.e., then $integral_RR f <= integral_RR g$
]

#proof[
  1. $- integral_RR f^- <= integral_RR f <= integral_RR f^+$ and $integral_RR f^(plus.minus) <= integral_RR |f|$.
  2. We know $integral_RR |f| < infinity$ so $|f| < infinity$ a.e. by properties of integrals of non-negative functions so $m({f = plus.minus infinity}) = 0$
  3. $|a f| <= |a| |f|$ so by monotonicity of non-negative functions, $integral_RR |a f| <= |a| integral_RR |f| < infinity$ so $a f$ in $L^1 (RR)$. Note then that $
  (a f)^+ = cases(a f^plus "if" a >= 0, - a f^- "if" a < 0), wide (a f)^minus = cases(a f^- "if" a >= 0, - a f^+ "if" a < 0)
  $ so $
  integral_RR a f &= integral_RR (a f)^+ - integral_RR (a f)^-\
  &= cases(
    integral_RR a f^+ - integral_RR a f^- "if" a >= 0\
    integral_RR (-a) f^- - integral_RR (-a) f^+ "if" a < 0
  )\
  &= cases(
    a (integral_RR f^+ - integral_RR f^-) "if" a >= 0\
    (-a) (integral_RR f^- - integral_RR f^+) "if" a < 0
  ) = a integral_RR f.
  $ By the same argument $b g in L^1 (RR)$ and $integral_RR (b g) = b integral_RR g$. wlog, $a = b = 1$. We want to show $f + g in L^1 (RR)$; clearly $|f + g| <= |f| + |g| < infinity$ so it must be $f + g in L^1 (RR)$. Set $h := f + g$ then $|h, f, g| < infinity$ a.e. and each of the integrals of $|h, f, g| < infinity$. Then, $h^+ - h^- = f^+ - f^- + g^+ - g^-$. Then $h^+ + f^- + g^- = f^+ + g^+ + h^-$, where now both sides are non-negative functions. By linearity of integrals of non-negative functions and since all terms finite a.e., $
  integral h^+ + integral f^- + integral  g^- &=integral  f^+ +integral  g^+ + integral  h^-\
  &=> integral h^+ - integral h^- = integral f^+ - integral f^- + integral g^+ - integral g^-\
  &=>  integral (f + g) = integral h = integral f + integral g.
  $
  4. $|integral_A f| <= integral_A |f| = 0$.
  5. Put $h = g - f$ (valid since $f, g in L^1 (RR)$) then $h >= 0$ a.e. Then $integral_RR h >= 0$ so by linearity $integral_RR (g - f) = integral_RR g - integral_RR f >= 0$.
]

== Convergence Theorems of Integral

#theorem("Monotone Covergence Theorem (MON)")[
Assume ${f_n}$, $f$ are non-negative, measurable functions. If $f_n arrow.t$ and $lim_(n->infinity) f_n = f$, then $
integral_RR f = lim_(n->infinity) integral_RR f_n.
$
]
#remark[
  When we write $lim_n f_n = f$, we mean pointwise convergence; however, one can replace these statements with convergence a.e. and obtain an equivalent, more general result wlog.
]
#proof[
  By monotonicity of non-negative functions, $lim_(n -> infinity) integral_RR f_n$ exists, forming an increasing sequence. Since $f_n <= f$, then we know too that $lim_(n-> infinity) integral_RR f_n <= integral_RR f$. 

  Conversely, for every $n$, let ${phi_(n, k)}_(k in NN)$ be a sequence of simple functions such that $phi_(n, k) arrow.t$ w.r.t $k$ and $phi_(n, k) -> f_n$ as $k -> infinity$;
  $
  f_1 & wide f_2 & wide dots.c & wide f_k & wide f_(k+1) & wide dots.c & wide -> f\
  dots.v & wide dots.v  & wide  dots.up & wide  dots.v & wide dots.v\
  phi_(1, k) & wide phi_(2, k) & wide dots.up & wide phi_(k,k) & wide phi_(k+1, k) & wide dots.c \
  dots.v & wide dots.v  & wide  dots.up & wide  dots.v & wide dots.v & wide dots.c \
  phi_(1, 2) & wide phi_(2, 2) & wide dots.up & wide phi_(k,2) & wide phi_(k+1, 2)& wide dots.c  \
  phi_(1, 1) & wide phi_(2, 1) & wide dots.c & wide phi_(k,1) & wide phi_(k+1, 1) & wide dots.c \
  
  $
   For each $k >= 1$, let $
  g_k := max{phi_(1,k), phi_(2,k), dots, phi_(k,k)}.
  $ Then, $g_k$ simple for each $k$, and $g_k arrow.t$ and $g_k <= f$. So, $lim_(k->infinity) g_k$ exists. Then, for all $n >= 1$, $lim_(k->infinity) g_k >= lim_(k->infinity) phi_(n, k) = f_n$ so $lim_(k->infinity) g_k >= lim_(n -> infinity) f_n = f$. Thus, $lim_(k -> infinity) integral_RR g_k = integral_RR f$ by a previous theorem. Since $forall k >= 1$, $phi_(1, k), phi_(2, k), dots.c, phi_(k, k) <= f_k$, $g_k <= f_k$ and thus by monotonicity $integral_RR g_k <= integral_RR f_k => integral_RR f =  lim_(k -> infinity) integral_RR g_k <= lim_(k->infinity) integral_RR f_k$ as desired.
]

#corollary[
  If ${f_n}, f$ measurable functions such that $f_n arrow.t$ and $lim_n f_n = f$ and $integral_RR f_1^- < infinity$, then $integral_RR f = lim_(n) integral_RR f_n$.
]
#proof[
Since $f_n arrow.t, f_n >= f_1$ so $f >= f_1$. Then, $f_n^- <= f_1^-, f^- <= f_1^-$, all of these are finite valued a.e., and $integral_RR f_n^- <= integral_RR f_1^- < infinity$ and $integral_RR f^- <= integral_RR f_1^- < infinity$. For each $n >= 1$, set $tilde(f_n) := f_n + f_1^- = f_n^+ - f_n^- + f_1^- >= 0$, and $tilde(f_n) arrow.t$ with $lim_(n) tilde(f_n) = f + f_1^- =: tilde(f) >= 0$. By MON, $integral_RR tilde(f) = lim_(n) integral_RR tilde(f_n)$ so $integral_RR (f + f_1^-) = lim_(n) integral_RR (f_n + f_1^-)$.

We have that $tilde(f_n) = f_n + f_1^- = f_n^+ - f_n^- + f_1^- => tilde(f_n)+ f_n^- = f_n^+ + f_1^-$, which is valid since $f_n^- < infinity$ a.e.. By linearity, then, $
integral_RR tilde(f_n) + integral_RR f_n^- &= integral_RR f_n^+ + integral_RR f_1^-\
&=> integral_RR tilde(f_n) = integral_RR f_n^+ - integral_RR f_n^- + integral_RR f_1^- wide "because" integral_RR f_n^- < infinity\
&=>integral_RR tilde(f_n) = integral_RR f_n + integral_RR f_1^-.
$ Similar work gives $integral_RR tilde(f) = integral_RR f + integral_RR f_1^-$, and taking limits and using $lim_n integral_RR (f_n + f_1^-) = integral_RR (f + f_1^-)$ completes the proof.
]

#theorem("Reverse MON")[
  Assume ${f_n}$, measurable such that $f_n arrow.b$ and $lim_(n->infinity) f_n = f$. If $integral_RR f_1^+ < infinity$, then $integral_RR f = lim_(n) integral_RR f_n$.
]

#proof[
  Consider ${-f_n}$ and use the previous corollary.
]

#theorem("Fatou's Lemma")[
  Assume ${f_n}$ non-negative, measurable. Then $
  integral_RR (liminf_(n->infinity) f_n) <= liminf_(n->infinity)( integral_RR f_n).
  $
]

#proof[
  For every $m >= 1$, set $g_m := inf_(n >= m) f_n$. Then, $g_m$ non-negative and $g_m arrow.t$, with $lim_(m) g_m = liminf_n f_n$. By MON, $integral_RR liminf_n f_n = lim_(m->infinity) (integral_RR g_m)$. For every $n >= m$ , $g_m <= f_n$, so by monotonicity, $integral_RR g_m <= integral_RR f_n$ for every $n >= m$, so $integral_RR g_m <= inf_(n >= m) integral_RR f_n$, and hence $lim_(m->infinity) integral_RR g_m <= lim_(m -> infinity) inf_(n>=m) integral_RR f_n = liminf_(n) (integral_RR f_n)$, and the proof follows.
]

#corollary[
  Assume ${f_n}$ measurable and there exists a measurable function $g$ such that $integral_RR g^- < infinity$ and $f_n >= g$ for every $n$. Then, $
  integral_RR (liminf_n f_n) <= liminf_n (integral_RR f_n).
  $
]

#proof[
  Since $f_n >= g$ for all $n >= 1$, $f_n^- <= g^-$ so $f_n^- < infinity$ a.e. and $integral_RR f_n^- < infinity$. Set $tilde(f_n) := f_n + g^- >= 0$. Then, apply Fatou to get $integral_RR liminf_n tilde(f_n) <= liminf_n integral_RR tilde(f_n)$, then it suffices to check linearity.
]

#theorem("Reverse Fatou")[
  Assume ${f_n}$ measurable and there exists a $g$ measurable such that $integral_RR g^+ < infinity$ and $f_n <= g$ for all $n >= 1$. Then, $
  integral_RR (limsup_n f_n) >= limsup_n (integral_RR f_n).
  $
]
#proof[
  Apply previous proof to ${-f_n}$.
]

#remark[
  The "floor" $g$ is necessary. Let $f_n (x) := cases(-1 & "if" x>= n, 0 & "if" x < n)$. Then, $f_n arrow.t$, and $lim_n f_n = 0$ while $integral_RR f_n = -infinity$ for every $n$, so MON doesn't apply.
]

#theorem("Dominated Convergence Theorem (DOM)")[
Assume ${f_n}, f$ measurable with $lim_(n) f_n = f$. If there exists a $g in L^1 (RR)$ such that $|f_n| <= |g|$ for all $n$, then $f_n -> f$ in $L^1 (RR)$ i.e. $lim_(n->infinity) integral_RR |f_n - f| =0$. In particular, $integral_RR f = lim_n integral_RR f_n$.
]

#proof[
  Since $|f_n| <= |g|$ and $f = lim_(n->infinity) f_n$, then $|f| <= |g|$. So, $integral_RR |f_n| <= integral_RR |g| < infinity$ and similarly $integral_RR |f| <= integral_RR |g| < infinity$ so $|f_n|, f in L^1 (RR)$.

  Observe that $|f_n - f| <= 2 |g|$, and $integral_RR (2 |g|) < infinity$. Applying Reverse Fatou to ${|f_n - f|}_(n in NN)$, we find $
  integral_RR (underbrace(limsup_n (|f_n - f|), 0)) &>= limsup_n (integral_RR |f_n - f|)\
  &=>  lim_(n -> infinity) integral_RR |f_n - f|= 0,
  $ so in particular $
  |integral_RR f_n - integral_RR f| = |integral_RR (f_n - f)| <= integral_RR |f_n - f| -> 0
  $ so $lim_(n) integral_RR f_n = integral_RR f$.
]

#remark[
  We must find $g in L^1 (RR)$ to dominate $|g| >= |f_n|$ irrespective of $n$. For instance, if $f_n = bb(1)_[n,2n]$, then $lim_(n) f_n = 0$, but $integral_RR f_n = n$ for all $n >= 1$. DOM doesn't apply, since we would need a constant $1$ function to dominate all $f_n$, which is not integrable.
]

#proposition[Assume $f in L^1 (RR), {h_n}$ a sequence of measurable functions that are uniformly bounded, i.e. $exists M > 0$ such that $|h_n| <= M$ a.e. for all $n >= 1$. If $h_n -> h$ a.e. for some measurable function $h$, then $
lim_n integral_RR (f h_n) = integral_RR (f h).
$]

#proof[
  For every $n$, $|f dot h_n| <= M |f| in L_1 (RR)$. The conclusion follows from DOM.
]

#corollary[
  If $f in L^1 (RR)$ then for all $epsilon > 0$, there exists a compact set $K subset.eq RR$ such that $integral_(K^c) |f| <= epsilon$.
]
#proof[
  If $h_n := bb(1)_[-n,n]$, the $lim_(n) integral_RR f h_n = lim_n integral_[-n,n] f = integral_RR f$, and also $lim_(n) integral_{RR minus[-n,n]} f = 0$.
]

#corollary[
If $f in L^1 (RR)$, then for all $epsilon > 0$, $exists N >= 1$ such that $integral_{|f| > N} |f| <= epsilon$.
]

#proof[
Let $h_n = bb(1)_{|f| >n}$ then $lim_(n->infinity) integral_{|f| > n} f = 0$.
]

#corollary[If ${A_n} subset.eq cal(M)$ such that $A_n arrow.t$, then $integral_(union_(n=1)^infinity A_n) f = lim_(n->infinity) integral_(A_n) f$ ($bb(1)_(A_n) f -> bb(1)_(union_(n=1)^infinity A_n) f$).]

#corollary("Countable Additivity")[If ${B_n} subset.eq cal(M)$ are disjoint, then $integral_(union_(n=1)^infinity B_n) f = sum_(n=1)^infinity integral_(B_n) f$.]

#corollary[
  If ${A_n} subset.eq cal(M)$ such that $A_n arrow.b$, then $integral_(sect_(n=1)^infinity A_n) f = lim_(n->infinity) integral_(A_n) f$.
]

#proposition[Assume $f$ is non-negative, measurable, and finite-valued a.e.. Then, for every $k in ZZ$, put $A_k := {x in RR : 2^k  <= f(x) < 2^(k+1)}$. Then, $
f "integrable" <=> integral_RR f < infinity <=> sum_(k in ZZ) 2^k m(A_k) < infinity.
$
]

#proof[($=>$) Note that the $A_k$'s disjoint and $union.big_(k in ZZ) A_k = {0 < f < infinity}$. So, $
integral_RR f &= underbrace(integral_{f=0} f, = 0 "since" f = 0) + integral_{0<f<infinity} + underbrace(integral_{f=infinity} f, = 0 "since" f < infinity "a.e.") = sum_(k in ZZ) integral_(A_k) f.
$ For each $k in ZZ$, for every $x in A_k$, $2^k <= f(x) < 2^(k+1)$ so $2^k m(A_k) <= integral_A_k f(x) <2^(k+1) m(A_k)$. Hence, $
sum_(k in ZZ) 2^k m(A_k) <= sum_(k in ZZ) integral_(A_k) f = integral_RR f < infinity.
$ 
($arrow.double.l$) Suppose $sum_(k in ZZ) 2^k m(A_k) < infinity$. We know again $
integral_RR f = integral_({0 < f < infinity}) f =_("By MON") sum_(k in ZZ) integral_(A_k) f < sum_(k in ZZ) 2^(k+1) m(A_k) = 2 sum_(k in ZZ) 2^(k) m(A_k) < infinity. // TODO check
$
]

#example[
  Let $f(x) = |x|^(-alpha) bb(1)_[-1,1] (x)$, with $f(0) = infinity$ and $alpha > 0$; $f$ finite-valued a.e.. For every $k in ZZ$, put $A_k := {2^k <= f < 2^(k+1)} = {x in [-1, 1] : 2^k <= |x|^(-alpha) < 2^(k+1)}$. By definition, $|f| >= 1$, so $
  A_k = [-2^(-k/alpha), -2^((-(k+1))/alpha)) union (2^((-(k+1))/alpha), 2^(-k/alpha)] "for" k >= 0, wide A_k = nothing "if" k < 0.
  $ Hence, $
  sum_(k in ZZ) 2^k m(A_k) = sum_(k=0)^infinity 2^k dot 2 dot (1-2^(-1/alpha))2^(-k/alpha) = 2(1-2^(-1/alpha)) sum_(k=0)^infinity 2^(k(1-1/alpha)).
 $ Hence, the series $< infinity <=> alpha < 1$, and thus $integral_[-1,1] |x|^(-alpha) dif x < infinity <=> alpha < 1$.
]

#example[
  Let $g(x) = |x|^(-beta) bb(1)_(RR-[-1,1]) (x)$ with $beta > 0$. We have $|g| < 1$; we again put $
  A_k := {2^k <= g < 2^(k+1)} = cases(
    [-2^(-k/beta), -2^((-(k+1))/beta)) union (2^((-(k+1))/beta), 2^(-k/beta)] & "if" k < 0\
    nothing & "if" k >= 0.
  ) .
  $ So, $
  integral_(RR - [-1, 1]) |x|^(-beta) dif x < infinity <=> sum_(k in ZZ) 2^k m(A_k) < infinity <=> beta > 1.
  $
]

#example[
Let $f_n (x) = (1 + x/n)^(-n) sin(x/n)$. What is $lim_(n->infinity) integral_((0, infinity)) f_n (x) dif x$? We have that for all $x > 0$, $lim_(n->infinity) f_n (x) = 0$. We have that since $|sin (x/n)| <= 1$, so $
|f_n (x)| <= (1+x/n)^(-n) <= (1+x/2)^(-2) forall x > 0, forall n >= 2.
$ Let $g(x) := (1+x/2)^(-2)$. We would like to apply DOM, so we need to check that $g in L^1 ((0, infinity))$. We have that $
integral_((0, infinity)) g = integral_(0,1] g + integral_((1, infinity)) g <=  integral_(0,1] 1 + underbrace(integral_((1, infinity)) 4/x^2 dif x, beta = 2 "of previous example")< infinity,
$ so indeed $g in L^1 ((0, infinity))$. Applying DOM, then, we have that $
lim_(n->infinity) integral_((0, infinity)) f_n = integral_((0, infinity)) lim_(n->infinity) f_n = 0.
$
]

#example[
  Let $c > 0$, $f_n (x) = x^(-c) (cosh x)^(-1/n)$. What is $lim_n integral_((1, infinity)) f_n$?

  For every $x > 1$, $cosh x > 1$, so $(cosh x)^(-1/n) arrow.t$ with respect to $n$, with $lim_(n) (cosh x)^(-1/n) = 1$, so $lim_(n->infinity) f_n (x) = x^(-c)$ for every $x > 1$. Let $g(x) = x^(-c)$, then. By previous examples, when $c > 1$, $g in L^1 ((1, infinity))$ so DOM applies and thus $
  lim_n integral_((1, infinity)) f_n = integral_((1, infinity)) lim_n f_n = integral_((1, infinity)) x^(-c) dif x < infinity.
  $
  When $0 < c <= 1$, by Fatou, $
  liminf_n integral_((1, infinity)) f_n >= integral_((1,infinity)) liminf_n (f_n) = integral_((1,infinity)) x^(-c) dif x,
  $ since $f_n$ converges. When $0 < c <= 1$, the RHS $= infinity$, and thus $lim_(n->infinity) integral_((1,infinity)) f_n = infinity$.
]

#example[
  Let $c >= 0$, $f_n (x) := n/(1+n^2 x^2)$ for $x >= 0$. What is $lim_n integral_([c, infinity)) f_n$? 
  
  We have that $
  lim_n f_n (x) = cases(0 & "if" x > 0, infinity & "if" x = 0).
  $ 
  
  On $x in [1, infinity)$, $f_n (x) >= f_(n+1) (x)$ for all $n >= 1$, namely $f_n arrow.b$, and so $f_n (x) <= f_1 (x) = 1/(1+x^2)$. $f_1 (x) in L^1 (RR)$, by comparison with $1/(x^2)$ $(alpha = 2)$.

  If $x in (0, 1)$, $f_n (x) = 1/x (n x)/(1 + (n x)^2) <= A 1/x $, with $A := sup_(t > 0) t/(1+t^2) < infinity$. But $A/x in.not L^1 ((0, 1))$.

  When $c > 0$, for all $x >= c$ and for all $n >= 1$, $
  f_n (x) <= bb(1)_([1, infinity)) (x) 1/(1+x^2) + bb(1)_[c, 1) A/x <= bb(1)_[1, infinity) (x) 1/(1+x^2) + bb(1)_[c, 1) (x) A/c in L^1 ([c, infinity)).
  $ Hence, we may apply DOM, so $
  lim_n integral_([c, infinity)) f_n  = integral_([c, infinity)) lim_n f_n = 0,
  $ when $c > 0$. However, when $c = 0$, we have no such dominating function; so what is $integral_[0, infinity) f_n (x) dif x$?
]

== Riemann Integral vs Lebesgue Integral

Recall; let $f$ be bounded on $[a, b]$. Then, $f$ is Riemann integrable on $[a, b]$ if $
cases(f "is continuous on" [a, b], f "is monotonic on" [a, b], f "is continuous except at possibly finitely many points in" [a, b]).
$

Recall the function $f = bb(1)_(QQ sect [0, 1])$. $f$ is not Riemann integrable, but is Lebesgue integrable, because $|f| <= bb(1)_[0, 1] in L^1 (RR)$.

#remark[
  1. $exists$ bounded functions on $[a, b]$ that are not Riemann integrable.
  2. In general, $g$ being Riemann integrable and $|f| <= |g| arrow.double.r.not f$ is Riemann integrable ($bb(1)_(QQ sect [0, 1]) <= bb(1)_[0,1]$).
  3. In general, DOM and MON do _not_ apply to Riemann integrable. For instance, consider ${q_n}$ an enumeration of $QQ sect [0, 1]$. Define $f_n (x) := cases(1 &"if" x in {q_1, dots, q_n}, 0 &"else")$. $f_n arrow.t$, with $f_n -> bb(1)_(QQ sect [0, 1])$. So, MON applies with the Lebesgue integral, but $f_n$ is only discontinuous, for every $n$, at finitely many points, so $f_n$ Riemann integrable with $integral_0^1^((R)) f_n = 0$, but the limit is not Riemann integrable.
]

#theorem[Assume $f$ is Riemann integrable on $[a, b]$. Then, $f$ is Lebesgue integrable on $[a, b]$, i.e. $f in L^1 ([a, b])$. Moreover, $integral_a^b^((R)) f = integral_[a, b] f$.]

#proof[
  $f$ is Riemann integrable on $[a, b]$, so there is some $M > 0$ such that $|f| <= M$ on $[a, b]$. Further, there exist step functions $phi_n, psi_n$ with $phi_n <= f <= psi_n$ on $[a, b]$ and $|phi_n|, |psi_n| <= M$ for all $n >= 1$, and $
  lim_(n->infinity) integral_(a)^b^((R)) phi_n =   integral_(a)^b^((R)) f = lim_(n->infinity) integral_(a)^b^((R)) psi_n.
  $ Denote $phi := lim_(n->infinity) phi_n, psi:= lim_(n->infinity) psi_n$, which exist by Monotonicity. Since $phi_n, psi_n$ are step functions, they are measurable hence $phi, psi$ measurable with $phi <= f <= psi$. Observe that the Lebesgue, Riemann integral coincide on step functions. Hence, $integral_a^b^((R)) phi_n = integral_[a, b] phi_n$, same with $psi_n$. By DOM, (with $M$ as the dominator) $
  integral_[a, b] phi = lim_n integral_[a, b] phi_n  = lim_n integral_a^b^((R)) phi_n = integral_a^b^((R)) (f) = lim_n integral_a^b^((R)) psi_n = lim_n integral_[a, b] psi_n = integral_[a, b] psi.
  $ Since $phi <= psi$ and $integral_[a, b] (psi - phi) = 0$, we have that $psi = phi$ a.e. on $[a, b]$ by properties of integrals of non-negative functions, and thus $f = phi = psi$ a.e. on $[a, b]$. In particular, then, $f$ is measurable, being equal a.e. to measurable functions. Thus, since $|f| <= M$ on $[a, b]$, $f in L^1 ([a, b])$, and so since integrals agree on functions that are equal a.e.,  $integral_[a, b]  f = integral_[a, b] phi = integral_a^b^((R)) f$ as desired.
]

#example[
  We return to our example of computing $lim_(n->infinity) integral_([0, infinity)) n/(1+n^2 x^2) dif x$. We may rewrite $
  integral_([0, infinity)) n/(1+n^2 x^2) dif x = integral_([0, T]) n/(1+n^2 x^2) dif x + integral_([T, infinity)) n/(1+n^2 x^2) dif x
  $ where $T > 0$. We know from the previous example that the RHS integral converges to 0 by application of DOM. Now, $n/(1+n^2 x^2)$ is continuous on $[0, T]$ and thus Riemann integrable, and so by the previous theorem $
  integral_([0, T]) n/(1+n^2 x^2) = integral_([0, T])^((R)) n/(1+n^2 x^2) = arctan(n T).
  $ As $n -> infinity$, $arctan(n T) -> pi/2$, and thus the limit of the whole integral indeed exists, and is in fact equal to $pi/2$.
]

== $L^p$-space

#definition([$p$-integrable])[Let $f$ measurable and $1 <= p < infinity$. We say $f$ is _$p$-integrable_ and write $f in L^p (RR)$ if $integral_RR |f|^p < infinity$, i.e. $|f|^p in L^1 (RR)$.

For $f in L^p (RR)$, define the $p$-norm $
||f||_p := (integral_RR |f|^p)^(1/p).
$
]

#remark[When $p = 1$, we see that $||dot||_1$ a norm fairly clearly from properties of the integral. We need to show this for more general $p > 1$.]

#remark[$||dot||_p$ also defined when $p = infinity$; given $f$ measurable, we define $
||f||_infinity := "ess sup"_(x in RR) |f(x)| := inf {a in overline(RR) : |f| <= a "a.e."}.
$ Then, we define $
L^infinity (RR) := {f "measurable s.t." ||f||_infinity < infinity}.
$ One can show that if $f in L^infinity (RR)$, $|f| <= ||f||_infinity$ a.e..
]

#theorem("Hölder's Inequality")[Let $1 < p < infinity$ and let $q := p/(p-1)$ (such a $q$ is called the _Hölder Conjugate_ of $p$). If $f in L^p (RR)$ and $g in L^q (RR)$, then $f g in L^1 (RR)$, and $
||f g||_1 <= ||f||_p ||g||_q.
$ In particular, if $p = q = 2$, then we have the _Cauchy-Schwarz Inequality_.
]

#remark[$1/p + 1/q = 1$.]

#proof[
  We will employ "Young's Inequality", which states that for all $a, b >= 0$, $a b <= (a^p)/p + (b^q)/q$ where $1/p + 1/q = 1$. Since $f in L^p, g in L^q$,  set $tilde(f) := f/(||f||_p)$ and $tilde(g) := g/(||g||_q)$. Then, a.e. $
  |tilde(f) tilde(g)| <= (|tilde(f)|^p)/p + (|tilde(g)|^q)/q.
  $ We have $
  integral_RR |tilde(f) tilde(g)| = integral_RR (|f g|)/(||f||_p ||g||_q)
  $ and $
  integral_RR  (|tilde(f)|^p)/p + (|tilde(g)|^q)/q = 1/p (integral_(RR) |f|^p)/(||f||_p^p) + 1/q (integral_(RR) |g|^q)/(||g||_q^q) = 1/p + 1/q = 1,
  $ and thus $
  integral_(RR) |f g| = ||f g||_q <= ||f||_p ||g||_q
  $ as required.
]

#remark[This inequality also holds for $p = 1, q = infinity$ (assignment question).]

#lemma[For all $a, b >= 0$, $a b <= (a^p)/p + (b^q)/q$ where $1/p + 1/q = 1$.]
#proof[
  // TODO
]

#theorem("Minkowski's Inequality")[
Let $1 <= p < infinity$ and $f, g in L^p (RR)$. Then, $f + g in L^p (RR)$, and in particular $
||f + g||_p <= ||f||_p + ||g||_p.
$ In particular, then, $||dot||_p$ satisfies the triangle inequality and is indeed a norm on $L^p (RR)$.
]
#proof[
We have $|f+ g|^p <= 2^p (|f|^p + |g|^p)$ hence $f + g in L^p (RR)$ since $|f|^p, |g|^p in L^1 (RR)$. Further $
integral_RR |f+g|^p = integral_RR |f+g| |f+g|^(p-1) &<= integral_RR |f| |f+g|^(p-1) + integral_RR |g| |f+g|^(p-1)\
("Hölder's") wide &<= (integral_(RR) |f|^p)^(1/p) (integral_RR |f+g|^((p-1)q))^(1/q) +  (integral_(RR) |g|^p)^(1/p) (integral_RR |f+g|^((p-1)q))^(1/q) \
&<= (||f||_p + ||g||_p) (integral_RR |f+g|^p)^(1/q)\
&=>  ||f+g||_p = (integral_RR |f+g|^p)^(1/p) = (integral_RR |f+g|^p) dot (integral_RR |f+g|^p)^(-1/q) \
& wide <= (||f||_p + ||g||_p) (integral_RR |f+g|^p)^(1/q) dot (integral_RR |f+g|^p)^(-1/q) =  ||f||_p + ||g||_p \
& => ||f+g||_p <= ||f||_p + ||g||_p
$
]

#remark[Minkowski's also holds for $p = infinity$.]

#lemma[
  Let $1 <= p < infinity$. If ${g_k} in L^p (RR)$ such that $sum_(k=1)^infinity ||g_k||_p < infinity$, then $exists G in L^p (RR)$ such that $G_m := sum_(k=1)^m g_k -> G$ as $m -> infinity$ a.e. as well as in $L^p (RR)$.
]

#proof[
  Put $tilde(G_m) := sum_(k=1)^m |g_k|$ and $tilde(G) := sum_(k=1)^infinity |g_k|$. Then, $tilde(G_m) arrow.t$ with $lim_(m->infinity) tilde(G_m) = tilde(G)$. By MON, $
  integral_RR tilde(G)^p = lim_(m->infinity) integral_RR tilde(G_m)^p = lim_(m->infinity) ||tilde(G_m)||_p^p <= lim_(m->infinity) (sum_(k=1)^m ||g_k||_p)^p
  $ where the final inequality is by Minkowski's. Then, $
   <= (lim_(m->infinity) sum_(k=1)^m ||g_k||_p)^p = (sum_(k=1)^infinity ||g_k||_p)^p < infinity, "by assumption"
  $ Hence, $tilde(G) in L^p (RR)$ and $||tilde(G)||_p <= sum_(k=1)^infinity ||g_k||_p$ and thus $tilde(G)$ finite-valued a.e. and hence $sum_(k=1)^infinity g_k$ absolutely convergent a.e.. Set $G =lim_(m->infinity) G_m = sum_(k=1)^infinity g_k$ a.e.. Moreover, we know $
  |G| = |sum_(k=1)^infinity g_k| <= sum_(k=1)^infinity |g_k| = tilde(G) => G in L^p (RR)
  $  and $
  |G - G_m| <= sum_(k=m+1)^infinity |g_k|.
  $ Fix $epsilon > 0$. Since $sum_(k=1)^infinity ||g_k||_p < infinity$, exists some $M >= 1$ such that $sum_(k=M+1)^infinity ||g_k||_p < epsilon$. Then, $
  integral_RR |G - G_M|^p <= integral_RR (sum_(k=M+1)^infinity |g_k|)^p &= lim_(L -> infinity) integral_RR (sum_(k=M+1)^L |g_k|)^p\
  ("Minkowski") wide & <= lim_(L->infinity) (sum_(k=M+1)^L ||g_k||_p)^p\
  &= (sum_(k=M+1)^infinity ||g_k||_p)^p <= epsilon
  $ hence $G_m -> G$ in $L^p (RR)$.
]

#theorem[Let $1 <= p < infinity$. Then $L^p (RR)$ is a complete normed space under the $p$-norm.]

#proof[
  Let $f_n in L^p (RR)$ be a Cauchy sequence under $||dot||_p$. We can choose a subsequence ${n_k}$ such that for every $k >= 1$, $||f_n_(k+1) - f_(n_k)||_p <= 2^(-k)$. Set $g_k := f_(n_(k+1)) - f_(n_k)$. By the lemma, if $G_m := sum_(k=1)^m g_k$, there exists some $G in L^p (RR)$ such that $G_m -> G$ a.e. and in $L^p (RR)$. In fact, we have $
  G_m = sum_(k=1)^m g_k = sum_(k=1)^m (f_(n_(k + 1)) - f_n_k) = f_(n_(m+1)) - f_n_1,
  $ hence $
  G = lim_(m->infinity) G_m = (lim_(m->infinity) f_(n_(m+1))) - f_n_1.
  $ Let $f := G + f_n_1$. Then, $f = lim_(m->infinity) f_(n_m)$ a.e. and since $G_m -> G$ in $L^p$, we have that $f_n_m -> f$ in $L^p$ as $m -> infinity$. It remains to show convergence in $L^p$ along the whole subsequence.

  Fix $epsilon > 0$. Let $N >= 1$ such that $sup_(k, ell >= N) ||f_k - f_ell||_p < epsilon$ and $m$ sufficiently large such that $n_m > N$ and $||f_(n_m) - f||_p <= epsilon$. Then, $
  ||f_n - f||_p <= underbrace(||f_n - f_(n_m)||_p, < epsilon) + underbrace(||f_n_m - f||_p, < epsilon)<2 epsilon,
  $ completing the proof.
]

#remark[$L^infinity$ also complete.]

=== Dense Subspaces of $L^p (RR)$
#lemma[Bounded and compactly supported functions are dense in $L^p (RR)$.]

#proof[
  Given $f in L^p (RR)$, set $
  f_n (x) = bb(1)_([-n,n]) (x) dot f(x) dot bb(1)_({|f| <= n}) (x)
  $ which are bounded and compactly supported on $[-n, n]$. We claim $f_n -> f$ in $L^p (RR)$. We have $integral_RR |f_n - f|^p $ nonzero only if $x in.not [-n,n]$ or $|f(x) > n|$. Hence $
  integral_RR |f_n - f|^p <= integral_(RR \\ [-n,n]) |f|^p + integral_({|f| > n}) |f|^p -> 0 "as" n-> infinity.  
  $
]

#lemma[
Simple functions are dense in $L^p (RR)$.
]

#proof[
  For $f in L^p (RR)$, let $f_n$ be as in the previous proof. For each $n >= 1, k = 0, 1, dots, n 2^n - 1$, set $
  A_(n, k) := {x in [-n, n] : k/(2^n) <= f_n^+ < (k+1)/2^n}, wide phi_(n)^+ :=  sum_(k=0)^(n 2^n - 1) k/2^n bb(1)_(A_(n,k)), 
  $ and $
  B_(n, k) := {x in [-n, n] : k/(2^n) <= f_n^- < (k+1)/2^n}, wide phi_(n)^- :=  sum_(k=0)^(n 2^n - 1) k/2^n bb(1)_(B_(n,k)).
  $ Put $phi_n := phi_n^+ - phi_n^-$. This is a simple function, and $|phi_n| <= n$ and supported on $[-n, n]$ for every $n$ hence $phi_n in L^p (RR)$. In addition, $lim_n phi_n (x) = f(x)$. In particular, for any $n >= 1$, $
  |f_n (x) - phi_n (x)| <= |f_n^+ (x) - phi_n^+ (x)| + |f_n^(-) (x) - phi_n^- (x)| <= 2 dot 2^(-n).
  $ Then, in particular $
  ||f - phi_n||_p <= underbrace(||f - f_n||_p, -> 0) + underbrace(||f_n - phi_n||_p, =(integral_([-n,n]) |f_n - phi_n|^p)^(1/p) \ <= (( 2 dot 2^(-n))^p m([-n,n]))^(1/p) -> 0),
  $ and so indeed $phi_n -> f$ in $L^p (RR)$.
]

#theorem[Let $C_c (RR)$ denote the space of continuous and compactly supported functions. Then, $C_c (RR)$ is dense in $L^p (RR)$ for $1 <= p < infinity$.]

#proof[
  Give $f in L^p (RR)$, let ${phi_n}$ simple functions as in the previous proof. Recall that, for every $n >= 1$, there exists a step function $theta_n$ such that $theta_n <= sup_x |phi_n (x)| <= n$, is supported on $[-n - 1, n+1]$, _and_ ${theta_n eq.not phi_n}$ has arbitrarily small measure. In particular, we choose $theta_n$ such that $m({theta_n eq.not phi_n}) <= 2^(-n - 1)$ for every $n >= 1$.

  Recall that given a step function $theta_n$, there exists a function $tilde(theta_n)$ continuous on $RR$, $tilde(theta_n)$ is supported on $[-n - 2, n + 2]$, _and_ $m({tilde(theta_n) - theta_n}) <= 2^(-n-1)$. Thus, ${tilde(theta_n)} subset.eq C_c (RR)$, and $
  m({tilde(theta_n) - phi_n}) <= m ({tilde(theta_n) eq.not theta_n}) + m({theta_n eq.not phi_n}) <= 2^(-n).
  $ So, we have $
  ||f - tilde(theta_n)||_p <= underbrace(||f - phi_n||_p, -> 0 "by lemma") + underbrace(||phi_n - tilde(theta_n)||_p, = (integral_RR |phi_n - tilde(theta_n)|^p)^(1/p) \ = (integral_{tilde(theta_n) eq.not phi_n}|phi_n - tilde(theta_n)|^p)^(1/p)\
   <= ((2n)^p 2^(-n))^(1/p) -> 0),
  $ and thus $tilde(theta_n) -> f$ in $L^p (RR)$.
]

#remark[
  The density of $C_c (RR)$ in $L^p (RR)$ is useful in the study of properties of generic $L^p$ functions. For instance, show that if $f in L^p (RR)$, then $lim_(n -> infinity) integral_RR |f(x+1/n) - f(x)|^p dif x = 0$, that is $f(dot + 1/n) -> f$ in $L^p (RR)$ using this density.
]

#remark[
  $C_c (RR)$ is _NOT_ dense in $L^infinity (RR)$.
]

== Convergence Modes and Uniform Integrability

Recall that, given ${f_n}, f$ measurable and finite-valued a.e., we have the following notions of convergence
+ $f_n -> f$ in measure $=>exists {n_k}$  such that $f_(n_k) -> f$ a.e. as $k -> infinity$
+ $f_n -> f$ a.e. on $A in cal(M)$ with $m(A) < infinity$ $=> f_n -> f$ in measure on $A$
+ $f_n -> f$ in $L^p (RR)$.


#proposition[
  If ${f_n}, f$ in $L^p (RR)$ for $1 <= p < infinity$ and $f_n -> f$ in $L^p (RR)$, then $f_n -> f$ in measure.
]

#proof[
  For $delta > 0$, we have $
  m({|f_n - f| > delta}) = integral_{|f_n - f| > delta} 1 dif x.
  $ Remark that $1 <= (|f_n - f|)/delta$ over ${|f_n - f| > delta}$; further $1^p = 1 <= ((|f_n - f|)/delta)^p$. Hence, $
   <= integral_({|f_n - f| > delta}) (|f_n - f|^p)/(delta^p) dif x <= 1/delta^p integral_RR |f_n - f|^p <= 1/(delta^p) ||f_n - f||^p_p.
  $ But by assumption $||f_n - f||^p_p -> 0$ for any $delta > 0$, hence $m({|f_n - f| > delta}) -> 0$ i.e. $f_n -> f$ in measure.
]

#remark[In general, convergence in $L^p arrow.r.double.not$ convergence a.e., with the same counter example from convergence in measure $arrow.r.double.not$ convergence a.e..]

#remark[When do we have convergence a.e. $=>$ convergence in $L^p$? This doesn't hold in general, unless some integral convergence theorem from before holds.]

#remark[When do we have convergence in measure $=> $ convergence in $L^p$? No in general, unless one of the integral convergence theorem holds; with some slight adaptation.]

#proposition("MON, Measure Version (mMON)")[
  Let $f_n$ non-negative with $f_n arrow.t$ and $f_n -> f$ in measure. Then, $
  integral_RR f = lim_n integral_RR f_n.
  $
]

#proof[
  $f_n -> f$ in measure implies $f_(n_k) -> f$ almost everywhere along some subsequence $n_k$, so it must be that $f$ non-negative. Suppose the claim fails. Then, there exists some subsequence ${n_ell}$ such that $integral_RR f_(n_ell) arrow.not integral_RR f$. However, along this subsequence we also have $f_(n_ell) -> f$ in measure, and hence exists a subsubsequence $n_ell_p$ such that $f_n_ell_p -> f$ a.e.. Then, by MON applied to this subsubsequence, we know that $
  lim_p integral_RR f_n_ell_p = integral_RR f,
  $ a contradiction. 
]

#proposition("mDOM")[
  If $f_n in L^1 (RR)$ with $f_n -> f$ in measure and there exists some $g in L^1 (RR)$ such that $|f_n| <= |g|$, then $f_n -> f$ in $L^1 (RR)$.
]

Recall that if $f in L^1 (RR)$, then $integral_{|f| > n} |f| ->$ as $n -> infinity$. The converse does not hold in general; consider $f equiv 1$. However, we can achieve a partial converse.

For $A in cal(M)$, we say $f in L^1 (A)$ if $integral_A |f| < infinity$.

#proposition[
  Given $A in cal(M)$ with $m(A) < infinity$, then $
  f in L^1 (A) <=> lim_n integral_(A sect {|f| > n}) |f| = 0.
  $
]
#proof[
  ($=>$) We've proven before, c.f. properties of integral of non-negative functions.

  ($arrow.l.double$) Choose $N$ such that $integral_(A sect {|f| > N}) |f| <= 1$. Then, $
  integral_A |f| &= integral_(A sect {|f| <= N}) |f| + integral_(A sect {|f| > N}) |f|\
  & <= N dot m(A) + 1 < infinity.
  $
]

#definition("Uniform Integrability")[Given ${f_n}$ measurable and $A in cal(M)$, we say ${f_n}$ is uniformly integrable on $A$ if $
lim_(M -> infinity) (sup_(n>=1)( integral_(A sect {|f_n| > M}) |f_n|)) = 0.
$]

#proposition[
  Let ${f_n}$ measurable, $A in cal(M)$. 
  + If $m(A) < infinity$ and ${f_n}$ uniformly integrable on $A$, then ${f_n}$ is bounded in $L^1 (A)$, that is $sup_(n >= 1) integral_A |f_n| < infinity$.
  + If ${f_n}$ is bounded in $L^p (A)$ for any $1 < p < infinity$, then ${f_n}$ is uniformly integrable on $A$.
]

#proof[
  + Let $M$ such that $sup_(n>=1) integral_(A sect {|f_n| > M}) |f_n| <= 1$. Then, we have that $
  sup_(n>=1) integral_A |f_n| &= sup_(n>=1) (integral_(A sect {|f_n| <= M}) |f_n| + integral_(A sect {|f_n| > M}) |f_n|)\
  & <= M dot m(A) + 1 < infinity.
  $ \
  2. For any $M > 0$, note that $1 <= ((|f_n|)/M)^(p-1)$ over $A sect {|f_n| > M}$. So, $
  sup_n integral_(A sect {|f_n| > M}) |f_n| &<= sup_n  integral_(A sect {|f_n| > M}) |f_n| ((|f_n|)/M)^(p-1)\
  &<=underbrace(1/(M^(p-1)), > 0) underbrace(sup_n integral_(A) |f_n|^p, < infinity) -> 0 "as" M->infinity.
  $
]
#remark[Notice that 2. does _not_ require finiteness of the measure of $A$, in particular one can take $A = RR$.]

#proposition[Given ${f_n}$ measurable and $A in cal(M)$ with $m(A) < infinity$, TFAE:\
(i) $f_n in L^1 (A) forall n >= 1$, $f in L^1 (A)$ and $f_n -> f$ in $L^1 (A)$,\
(ii) ${f_n}$ is uniformly integrable on $A$ and $f_n -> f$ in measure on $A$.
]

#proof[
  (i) $=>$ (ii) Assume $f_n -> f$ in $L^1 (A)$, hence $integral_A |f_n| -> integral_A |f|$ so ${f_n}$ bounded in $L^1 (A)$. Note we've already proven that $f_n -> f$ in measure. For $M > 0$, $
  integral_(A sect {|f_n| > M}) |f_n| &<= integral_(A sect {|f_n| > M}) |f_n - f| + integral_(A sect {|f_n| > M}) |f|\
  & <= underbrace(integral_A |f_n - f|, -> 0) + underbrace(integral_(A sect {|f_n| > M} sect {|f| <= sqrt(M)}) |f|, <= sqrt(M) dot m(A sect {|f_n| > M}) \
  <= sqrt(M) (sup_n integral_A |f_n|)/M -> 0 "as" M -> infinity \ ("Markov's")) + underbrace(integral_(A sect {|f_n| > M} sect {|f| > sqrt(M)}) |f|, <= integral_(A sect {|f| > sqrt(M)}) |f| -> 0 "since" f in L^1).
   $ Fix $epsilon > 0$. Choose $N$ such that for all $n >= N$, $integral_A |f_n - f| <= epsilon/3$, choose  $M$ such that $integral_(A sect {|f| > sqrt(M)}) |f| < epsilon/3$ and $(sup_n integral_A |f_n|)/sqrt(M) < epsilon/3$. Thus, $
   sup_(n >= N) integral_(A sect {|f_n| > M}) |f_n| <= epsilon/3 + epsilon/3 + epsilon/3 = epsilon.
   $ We want this to hold for $N = 1$ for uniformity, i.e. we need to deal with the first $N - 1$ terms. We achieve this by making $M$ larger if necessary such that $
   integral_(A sect {|f_k| > M} ) |f_k| <= epsilon
   $ for every $k = 1, 2, dots, N-1$. 


   (ii) $=>$ (i) assignment question.
  ]

  = Product space
  == Preparations
  Given a measure space $(X, cal(F), mu)$ with $mu$ a $sigma$-finite measure (i.e. there exists a sequence ${X_n} subset.eq cal(F)$ such that $X_n arrow.t$ and $union.big_n X_n = X$, and $mu(X_n) < infinity$ for each $n$).

  #definition("Measurable")[$f : X -> overline(R)$ is $cal(F)$-measurable if $forall a in RR$, $f^(-1)([-infinity, a)) in cal(F)$.]

  We have similar properties for $f$ in general as in the Lebesgue setting.
  -For $f$ $cal(F)$-measurable, $c f, f^k, |f|, f and a, f or b, f^+, f^-$ are all $cal(F)$-measurable for $a, b, c in RR$.
  - For $f, g$ $cal(F)$-measurable, $f + g, f - g, f dot g, f and g, f or g$ are all $cal(F)$-measurable.
  - If ${f_n}$ $cal(F)$-measurable, $sup_n f_n, inf_n f_n, limsup_n f_n, liminf_n f_n$ are $cal(F)$-measurable.

  We may "dissect" functions as before. For $f$ $cal(F)$-measurable, write $f = f^+ - f^-$, and put for $n >= 1$ and $bullet = +, -$, $
  f_n^bullet := bb(1)_(X_n) (f^bullet and n). 
  $ Then, $f_n^bullet arrow.t f^bullet$. Put $
  phi^bullet_n := sum_(k=0)^(n 2^n) k/2^n bb(1)_(A_(n,k)^bullet),
  $ where, for $k = 0,1, dots, n 2^n$ for $n >= 1$, $
  A_(n, k)^bullet = {x in X_n : k/2^n <= f_n^bullet < (k+1)/2^n} in cal(F).
  $ Then, we may define the integral of the simple function $
  integral_X phi_n^bullet dif mu := sum_(k=0)^(n 2^n) k/2^n mu(A_(n,k)^bullet).
  $ Define then $
  integral_X f^(bullet) dif mu := lim_n integral_X phi_n^bullet dif mu,
  $ and $
    integral_X f dif mu := integral_X f^+ dif mu - integral_X f^- dif mu.
  $ We say, then, $f in L^1 (mu)$ if $integral_X |f| dif mu < infinity$. This generalizes the notion of integration to a (slightly more) general $sigma$-algebra.

== Product Lebesgue $sigma$-Algebra

We will restrict our constructions to the product of 2 spaces, i.e. $RR^2$, but generalizes for general $RR^d$.

#definition([Product $sigma$-algebra])[
  The _product $sigma$-algebra_ of subsets of $RR^2$, denoted by $cal(M) times.circle cal(M)$ or simply $cal(M)^2$, is defined as $
  cal(M)^2 := sigma({A times B : A, B in cal(M)}),
  $ where $
  A times B := {(x, y) : x in A, y in B}
  $ as is standard.
]

Notice $cal(M)^2$ contains 
- rectangles $I_1 times I_2$, $I_1, I_2$ intervals;
- singletons ${(x, y)}$;
- open sets, closed sets, and so $frak(B)(RR^2) := sigma({"open sets in" RR^2}) subset.eq cal(M)^2$.

Given $G$ open, then for every $x in G$, there exists some disc centered at $x$ contained entirely in $G$. Moreover, there exist $(a_1, a_2), (b_1, b_2)$ with $a_i, b_i in QQ$ such that $x in (a_1, a_2) times (b_1, b_2) subset G$. Then, $G = union.big_(x in G)(a_1, a_2) times (b_1, b_2).
$

#definition("Slice")[Given $E subset.eq RR^2$, then for every $x in R$, define $
E_x := {y in RR : (x, y) in E} subset.eq RR,
$ called the _slice_ of $E$ at $x$. Similarly, define for $y in RR$, $
E^y := {x in RR : (x, y) in E} subset.eq RR.
$]

#proposition[
  If $E in cal(M)^2$, then for every $x in RR$, $E_x in cal(M)$, and for every $y in RR$ $E^y in cal(M)$; that is, product measurability $=>$ marginal measurability.
]

#proof[
  Define $
  cal(A) := {E subset.eq RR^2 : forall x in RR, E_x in cal(M)}.
  $ We claim $cal(A)$ a $sigma$-algebra of subsets of $RR^2$.

  - $RR^2 in cal(A)$? Yes, since for every $x in RR$, $RR^2_x = RR in cal(M)$.
  - Let $E in cal(A)$. Then, $E_x in cal(M)$ for every $x in RR$. But we have too $
  (E^c)_x = (E_x)^c,
  $ and since $E_x in cal(M) => (E_x)^c in cal(M)$, it follows that $E^c in cal(A)$.
  - If ${E_n} subset.eq cal(A)$, then for every $x in RR$, $
  (union.big_(n) E_n)_x = (union.big_(n) (E_n)_x) in cal(M)
  $ so $union.big_(n) E_n in cal(A)$.

  Hence, $cal(A)$ indeed a $sigma$-algebra of subsets of $RR^2$. For every $A, B in cal(M)$, we claim $A times B in cal(A)$. We have that for every $x in RR$, $
  (A times B)_x = cases(
    nothing & "if" x in.not A, B & "if" x in A
  ) in cal(M),
  $ hence $A times B in cal(A)$. Thus, since such sets generate $cal(M)^2$, it follows that $cal(M)^2 subset.eq cal(A)$, and so every set in $cal(M)^2$ has the desired property.

  An identical proof follows for $E^y$-type slices.
]

#remark[Notice we didn't prove $cal(A) = cal(M)^2$, indeed, because its not true.

For instance, let $E = N times A$ with $N$ the Vitali set and $A in cal(M)$. Then, for every $x in A$, $E_x = cases(A & "if" x in N, nothing & "if" x in.not N) in cal(M)$, but $E in.not cal(M)^2$, because for every $y in RR$, $E^y = cases(N &"if" y in A, nothing "else")$.

In fact, there eixsts sets such that $E_x$ and $E^y in cal(M)$ for every $x, y in RR$, but $E in.not cal(M)^2$ (the _Sierpinski set_).

However, if $E subset.eq RR^2$ a product set, i.e. $E = A times B$ for some $A, B subset.eq RR$, then $A, B in cal(M) => E in cal(M)^2$.
]

#definition("Slice of sets")[Let $f : RR^2 -> overline(RR)$ a function. For every $x in RR$, define $
f_x : RR -> overline(RR), wide f_x (y) := f(x, y),
$ called the _slice_ of $f$ at $x$. Similarly define $f^y$.]

#example[If $f = bb(1)_E$ for some $E subset.eq RR^2$, then $f_x = bb(1)_(E_x)$.]

#proposition[
If $f : RR^2 -> overline(R)$ is $cal(M)^2$-measurable, then for every $x in RR$, $f_x$ is $cal(M)$-measurable, and for every $y in RR$ $f^y$ is $cal(M)$-measurable.
]

#proof[
  Observe that for every $B subset.eq RR$, $
  (f^(-1)(B))_x = f_x^(-1) (B)
  $ for every $x in RR$, with similar for $thin^y$. In particular, then, if $f$ $cal(M)^2$-measurable, then for every $a in RR$, $f^(-1) ([-infinity, a)) in cal(M)^2$ hence $f_x^(-1) ([-infinity, a)) = (f^(-1) ([-infinity, a))_x in cal(M)$, with the same idea following for $thin^y$.
  // $epsilon -> 0$
]

#remark[
  - If $f : RR^2 -> R$ is continuous, then $f$ is measurable. For every $a in RR$, $f^(-1) ((-infinity, a))$ open by virtue (indeed, definition) of continuity, hence in $cal(M)^2$.
  - If $f = bb(1)_E$ for some $E subset.eq RR^2$, $f$ $cal(M)^2$-measurable $<=>$ $E in cal(M)^2$.
  - In general, there exists $f : RR^2 -> overline(R)$ such that $f_x$ $cal(M)$-measurable but $f$ is not $cal(M)^2$-measurable.
  - If $f(x, y) = h(x) g(y)$ for some non-trivial $h, g : RR -> overline(RR)$, then $f$ is $cal(M)^2$-measurable $<=>$ both $h$ and $g$ are $cal(M)$-measurable. We show $<=$; $
  f^(-1) ([-infinity, a)) &= {(x, y) : h(x) g(y) < a} \
  &= {(x, y) : h(x)= 0, 0 < a} \
  & wide union {(x, y) : h(x) > 0, g(y) < a/(h(x))} \
  & wide union {(x, y) : h(x) < 0, g(y) > a/(h(x))}\
  &= {x : h(x) = 0} times RR sect {0 < a} wide in cal(M)^2 \
  & wide union (union.big_(q in QQ) underbrace({x : 0 < h(x),  q < a/(h(x))}, in cal(M)) times underbrace({y : g(y) < q}, in cal(M)))\ 
  & wide union (union.big_(q in QQ) underbrace({x : 0 > h(x),  q > a/(h(x))}, in cal(M)) times underbrace({y : g(y) > q}, in cal(M))) in cal(M)^2
  $ 
]